
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–æ–≥–æ–∑–∞–≤—Ä:)</title>
    <link rel="icon" type="image/png" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iOCIgZmlsbD0iIzRhOTBlMiIvPgo8cGF0aCBkPSJNMTYgMjZjLTcuNzMyIDAtMTQtMy4xMzQtMTQtN3M2LjI2OC03IDE0LTcgMTQgMy4xMzQgMTQgN3MtNi4yNjggNy0xNCA3em0wLTEyYy01LjUyMyAwLTEwIDIuMjM5LTEwIDVzNC40NzcgNSAxMCA1IDEwLTIuMjM5IDEwLTUtNC40NzctNS0xMC01eiIgZmlsbD0iI2ZmZiIvPgo8cGF0aCBkPSJNMTAgMTVjMC0xLjEwNS45LTIgMi0yaDhjMS4xIDAgMiAuODk1IDIgMnYyYzAgMS4xMDUtLjkgMi0yIDJoLThjLTEuMSAwLTItLjg5NS0yLTJ2LTJ6IiBmaWxsPSIjZmZmIi8+CjxjaXJjbGUgY3g9IjEyIiBjeT0iMTYiIHI9IjEiIGZpbGw9IiM0YTkwZTIiLz4KPGNpcmNsZSBjeD0iMjAiIGN5PSIxNiIgcj0iMSIgZmlsbD0iIzRhOTBlMiIvPgo8L3N2Zz4=">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Cinzel:wght@700&family=Montserrat:wght@400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0; /* –£–±–∏—Ä–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã */
            background: linear-gradient(135deg, #f4f4f9, #e0e7ff);
            color: #333;
        }
        .header {
            width: 100%;
            height: auto; /* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—ã—Å–æ—Ç–∞ */
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px 0;
            position: relative;
        }
        .header img {
            max-width: 500px; /* –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
            max-height: 300px; /* –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
            width: auto;
            height: auto;
            object-fit: contain; /* –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é */
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        h1 {
            text-align: center;
            color: #4a90e2;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            font-family: 'Montserrat', sans-serif;
            font-size: 2.5em;
            margin-top: 20px; /* –û—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
        }
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(74, 144, 226, 0.1);
            flex-wrap: wrap;
            gap: 10px;
        }
        .tab {
            padding: 15px 25px;
            margin: 0 3px;
            border: 2px solid transparent;
            border-radius: 15px;
            background: linear-gradient(145deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
            color: #4a90e2;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.1);
        }
        
        .tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
            transition: left 0.6s;
        }
        
        .tab:hover::before {
            left: 100%;
        }
        
        .tab:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 30px rgba(74, 144, 226, 0.4);
            border-color: rgba(74, 144, 226, 0.5);
            background: linear-gradient(145deg, rgba(255,255,255,1), rgba(240,248,255,0.9));
        }
        
        .tab i {
            font-size: 1.3em;
            transition: all 0.3s ease;
        }
        
        .tab:hover i {
            transform: rotate(10deg) scale(1.2);
            text-shadow: 0 0 10px rgba(74, 144, 226, 0.5);
        }
        
        .tab.active {
            background: linear-gradient(145deg, #4a90e2, #357ab7, #2c5aa0);
            color: #fff;
            box-shadow: 0 8px 25px rgba(74, 144, 226, 0.6);
            transform: translateY(-3px);
            border-color: rgba(255, 255, 255, 0.3);
            animation: activeGlow 2s ease-in-out infinite alternate;
        }
        
        .tab.active i {
            color: #fff;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
            animation: iconPulse 2s ease-in-out infinite;
        }
        
        @keyframes activeGlow {
            0% {
                box-shadow: 0 8px 25px rgba(74, 144, 226, 0.6);
            }
            100% {
                box-shadow: 0 12px 35px rgba(74, 144, 226, 0.8);
            }
        }
        
        @keyframes iconPulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        .tab-content.active {
            display: block;
        }
        textarea {
            width: 100%;
            height: 200px;
            padding: 10px;
            border: 2px solid #4a90e2;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
            box-shadow: 0px 2px 5px rgba(0,0,0,0.1);
        }
        textarea:focus {
            border-color: #357ab7;
            box-shadow: 0px 4px 10px rgba(0,0,0,0.2);
        }
        button {
            padding: 10px 20px;
            margin: 10px 5px;
            border: none;
            border-radius: 5px;
            background-color: #4a90e2;
            color: white;
            font-size: 16px;
            cursor: pointer; /* –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫—É—Ä—Å–æ—Ä —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∫–Ω–æ–ø–∫–∏ */
            transition: background-color 0.3s, transform 0.3s, box-shadow 0.3s;
            box-shadow: 0px 2px 5px rgba(0,0,0,0.1);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-secondary {
            background: linear-gradient(145deg, rgba(255,255,255,0.9), rgba(240,248,255,0.8));
            color: #4a90e2;
            border: 2px solid #4a90e2;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }
        
        .btn-secondary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(74, 144, 226, 0.1), transparent);
            transition: left 0.6s ease;
        }
        
        .btn-secondary:hover::before {
            left: 100%;
        }
        
        .btn-secondary:hover {
            background: linear-gradient(145deg, #4a90e2, #357ab7);
            color: white;
            border-color: #357ab7;
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(74, 144, 226, 0.4);
        }
        
        .btn-secondary:hover i {
            transform: rotate(10deg) scale(1.1);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
        }
        .input-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        button:hover {
            background-color: #357ab7;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        button:active {
            transform: scale(0.95);
            box-shadow: 0px 2px 5px rgba(0,0,0,0.2) inset;
        }
        #results {
            margin-top: 20px;
            padding: 20px;
            background-color: #fff;
            border: 2px solid #4a90e2;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            animation: fadeIn 1s ease-in-out;
            font-family: 'Cinzel', serif;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            padding: 5px 0;
            font-size: 18px;
            display: flex;
            align-items: center;
            font-weight: bold;
        }
        .results-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        .results-column div {
            padding: 10px;
            border: 2px solid #4a90e2;
            border-radius: 5px;
            background-color: #fff;
            width: 100%;
            text-align: center;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            animation: slideIn 0.5s ease-in-out;
        }
        .monster-image {
            width: 50px;
            height: 50px;
            margin-right: 10px;
            border-radius: 5px;
            box-shadow: 0px 2px 5px rgba(0,0,0,0.2);
        }
        .coin {
            width: 20px;
            height: 20px;
            vertical-align: middle;
            animation: spin 3s linear infinite;
            display: inline-block;
        }
        
        @keyframes spin {
            0% { transform: rotateY(0deg); }
            50% { transform: rotateY(180deg); }
            100% { transform: rotateY(360deg); }
        }
        .item-image {
            width: 50px; /* –ò–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ 50px */
            height: 50px; /* –ò–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ 50px */
            vertical-align: middle;
            margin-right: 10px;
        }
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }
        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .checkbox-group input {
            margin: 0;
        }
        .add-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .add-item input {
            padding: 10px;
            border: 2px solid #4a90e2;
            border-radius: 5px;
            font-size: 16px;
        }
        .spoiler {
            margin: 10px 0;
        }
        .spoiler-content {
            display: none;
            padding: 10px;
            border: 2px solid #4a90e2;
            border-radius: 5px;
            background-color: #fff;
        }
        .spoiler-button {
            background-color: #4a90e2;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s, box-shadow 0.3s;
            box-shadow: 0px 2px 5px rgba(0,0,0,0.1);
        }
        .spoiler-button:hover {
            background-color: #357ab7;
            transform: scale(1.05);
        }
        .spoiler-button:active {
            transform: scale(0.95);
            box-shadow: 0px 2px 5px rgba(0,0,0,0.2) inset;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        #detailed-stats-container {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 2px solid #4a90e2;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(74, 144, 226, 0.15);
        }
        
        #detailed-stats-container h3 {
            color: #4a90e2;
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.5em;
            font-weight: 600;
        }
        
        .stats-spoiler {
            margin: 15px 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .spoiler-header {
            padding: 15px 20px;
            background: linear-gradient(145deg, #4a90e2, #357ab7);
            color: white;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .spoiler-header:hover {
            background: linear-gradient(145deg, #357ab7, #2c5aa0);
            transform: translateY(-2px);
        }
        
        .spoiler-header h4 {
            margin: 0;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .drop-type {
            font-size: 0.8em;
            background: rgba(255,255,255,0.2);
            padding: 3px 8px;
            border-radius: 12px;
            font-weight: normal;
        }
        
        .spoiler-arrow {
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }
        
        .spoiler-content {
            padding: 20px;
            background: white;
            border-top: 1px solid #e9ecef;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-box {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #4a90e2;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stat-box:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .frequency-table {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .frequency-table h5 {
            color: #4a90e2;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .frequency-table p {
            margin: 0;
            line-height: 1.6;
            color: #495057;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ "–†–µ–∫–æ—Ä–¥—ã" –∏ "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" */
        .records-container, .stats-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .records-section, .stats-section {
            flex: 1;
            min-width: 300px;
            background-color: #f5f5f5;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0px 2px 5px rgba(0,0,0,0.1);
            text-align: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ */
        }

        .stats-section h3 {
            color: #4a90e2;
            font-size: 1.4em;
            margin-bottom: 20px;
            position: relative;
            font-weight: 600;
        }

        .stats-section h3::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 2px;
            background: linear-gradient(90deg, #4a90e2, #357ab7);
            border-radius: 2px;
        }
        .record-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0px 1px 3px rgba(0,0,0,0.1);
        }
        .record-info {
            flex-grow: 1;
        }
        .record-date {
            color: #777;
            font-size: 0.8em;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ "–ò—Å—Ç–æ—Ä–∏—è" */
        .history-day {
            margin-bottom: 15px;
        }
        .history-date {
            font-weight: bold;
            cursor: pointer;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .history-date:hover {
            background-color: #e9e9e9;
        }
        .history-entries {
            display: none;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 0 0 5px 5px;
            margin-top: -5px;
            background-color: white;
        }
        .history-entry {
            margin-bottom: 10px;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .history-time {
            font-size: 0.9em;
            color: #666;
        }
        .history-type {
            font-weight: bold;
            margin-right: 10px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .stats-table th, .stats-table td {
            padding: 12px;
            text-align: left; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é */
            border: 1px solid #ddd;
        }

        .stats-table th {
            background-color: #4a90e2;
            color: white;
            font-weight: bold;
        }

        .stats-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .stats-table tr:hover {
            background-color: #f5f5f5;
        }

        .scale {
            width: 100%;
            background-color: #f2f2f2;
            border-radius: 8px;
            overflow: hidden;
            height: 16px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }

        .scale div {
            height: 100%;
            background: linear-gradient(90deg, #4a90e2, #357ab7, #4a90e2);
            border-radius: 8px;
            transition: width 0.8s ease-out;
            position: relative;
            overflow: hidden;
        }

        .scale div::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –±–µ–∑ —Å–ø–æ–π–ª–µ—Ä–æ–≤ */
        .stat-item {
            background: white;
            margin: 15px 0;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .stat-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(74, 144, 226, 0.2);
            border-color: #4a90e2;
        }
        
        .stat-item-header {
            padding: 15px 20px;
            background: linear-gradient(145deg, #4a90e2, #357ab7);
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 600;
        }
        
        .stat-item-header h4 {
            margin: 0;
            font-size: 1.1em;
            flex: 1;
        }
        
        .stat-item-header .item-image {
            border-radius: 5px;
            border: 2px solid rgba(255,255,255,0.3);
            background: white;
            padding: 2px;
        }
        
        .stat-item .stats-grid,
        .stat-item .frequency-table {
            padding: 15px 20px;
        }
        
        .stat-item .frequency-table {
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
            margin: 0;
        }
        
        .stat-item .frequency-table h5 {
            margin: 0 0 10px 0;
            color: #4a90e2;
            font-size: 1em;
        }
        
        .stat-item .frequency-table p {
            margin: 0;
            color: #666;
            line-height: 1.5;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è —Å—É–º–º—ã –¥–µ–Ω–µ–≥ */
        .money-total {
            font-weight: bold;
            font-size: 1em;
            color: #28a745;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            padding: 10px;
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.1), rgba(40, 167, 69, 0.05));
            border-radius: 8px;
            border-left: 4px solid #28a745;
            margin: 10px 0;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ */
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .item-card {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid var(--primary-color);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.1);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .item-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(74, 144, 226, 0.2);
        }

        .item-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2em;
            flex-shrink: 0;
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 4px;
            font-size: 1em;
        }

        .item-count {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 1.1em;
        }

        .results-summary {
            background: linear-gradient(135deg, rgba(74, 144, 226, 0.1), rgba(74, 144, 226, 0.05));
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            border-left: 4px solid var(--primary-color);
        }

        .summary-text {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.1em;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è Drop Rate –±–ª–æ–∫–∞ */
        .drop-rate-box {
            background: linear-gradient(135deg, #e8f5e8, #f0f8f0) !important;
            border: 1px solid #4caf50 !important;
            color: #2e7d32 !important;
            font-weight: 600 !important;
            grid-column: 1 / -1; /* –ó–∞–Ω–∏–º–∞–µ—Ç –≤—Å—é —à–∏—Ä–∏–Ω—É */
        }
        
        .drop-rate-box strong {
            color: #1b5e20 !important;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–±—Ä–æ—Å–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ - –≤ –µ–¥–∏–Ω–æ–º —Å—Ç–∏–ª–µ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º */
        .btn-reset {
            background: linear-gradient(145deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
            color: #4a90e2;
            border: 2px solid transparent;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.1);
        }
        
        .btn-reset::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
            transition: left 0.6s ease;
        }
        
        .btn-reset:hover::before {
            left: 100%;
        }
        
        .btn-reset:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 30px rgba(74, 144, 226, 0.4);
            border-color: rgba(74, 144, 226, 0.5);
            background: linear-gradient(145deg, rgba(255,255,255,1), rgba(240,248,255,0.9));
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 1.5em;
            }
            button {
                width: 100%;
            }
            .records-container {
                flex-direction: column;
            }
        }
        
        .record-item button {
            margin-left: 5px;
            padding: 5px;
            border: none;
            border-radius: 5px;
            background-color: transparent;
            color: #4a90e2;
            cursor: pointer;
            font-size: 18px; /* –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –¥–ª—è –∏–∫–æ–Ω–æ–∫ */
            transition: color 0.3s;
        }

        .record-item button:hover {
            color: #357ab7;
        }

        /* –î–æ–±–∞–≤–ª—è–µ–º –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .results-column, .stats-table th, .stats-table td {
            font-weight: bold;
        }

        /* –î–æ–±–∞–≤–ª—è–µ–º –∑–µ–ª–µ–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –∏—Ç–æ–≥–æ–≤—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */
        .total-result {
            font-weight: bold;
            color: green;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ "–î—Ä–æ–ø" */
        .drop-management {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .drop-controls, .drop-items-list, .drop-analysis {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .add-drop-item {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .add-drop-item input[type="text"] {
            flex: 1;
            min-width: 200px;
            padding: 10px;
            border: 2px solid #4a90e2;
            border-radius: 5px;
            font-size: 16px;
        }

        .currency-input {
            display: flex;
            gap: 8px;
            align-items: center;
            background-color: #f8f9fa;
            border: 2px solid #4a90e2;
            border-radius: 8px;
            padding: 8px;
        }

        .currency-field {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .currency-field input {
            width: 60px;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
        }

        .currency-field input::-webkit-outer-spin-button,
        .currency-field input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .currency-field input[type=number] {
            -moz-appearance: textfield;
        }

        .drop-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .drop-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            margin-bottom: 8px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #4a90e2;
        }

        .drop-item-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .drop-item-details {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .drop-item-name {
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
        }

        .drop-item-price {
            color: #28a745;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .drop-item-actions {
            display: flex;
            gap: 5px;
        }

        .drop-item-actions button {
            padding: 5px 8px;
            font-size: 14px;
            margin: 0;
        }

        .edit-btn {
            background-color: #ffc107;
            color: #333;
        }

        .edit-btn:hover {
            background-color: #e0a800;
        }

        .delete-btn {
            background-color: #dc3545;
        }

        .delete-btn:hover {
            background-color: #c82333;
        }

        .drop-results {
            margin-top: 20px;
        }

        .drop-summary {
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.1), rgba(40, 167, 69, 0.05));
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #28a745;
        }

        .drop-summary-text {
            font-weight: bold;
            color: #28a745;
            font-size: 1.2em;
            text-align: center;
        }

        .drop-stats-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            margin-bottom: 8px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .drop-stats-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .drop-stats-name {
            font-weight: bold;
            color: #333;
            min-width: 150px;
        }

        .drop-stats-count {
            color: #4a90e2;
            font-weight: 600;
            min-width: 80px;
        }

        .drop-stats-value {
            color: #28a745;
            font-weight: bold;
            min-width: 100px;
        }

        .drop-stats-percent {
            color: #6c757d;
            font-weight: 600;
            min-width: 60px;
        }

        .drop-progress-bar {
            flex: 1;
            margin: 0 15px;
        }

        .drop-progress {
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            height: 30px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .drop-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.8s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            font-weight: bold;
            min-width: 40px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }

        .edit-drop-form {
            display: none;
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
        }

        .edit-drop-form input {
            margin-right: 10px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }

        .no-drop-data {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 20px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å–µ–∫—Ü–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥—Ä–æ–ø–∞ */
        .drop-stats-section {
            margin-top: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(74, 144, 226, 0.15);
            border: 2px solid rgba(74, 144, 226, 0.2);
        }

        .drop-stats-section h2 {
            text-align: center;
            color: #4a90e2;
            margin-bottom: 25px;
            font-size: 1.8em;
            position: relative;
        }

        .drop-stats-section h2::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, #4a90e2, #357ab7);
            border-radius: 2px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—â–µ–≥–æ –¥–æ—Ö–æ–¥–∞ */
        .total-income-display {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 2px solid #4a90e2;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(74, 144, 226, 0.15);
        }

        .income-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .income-header h3 {
            color: #4a90e2;
            font-size: 1.5em;
            margin: 0;
            font-weight: 600;
        }

        .income-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }

        .income-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 10px;
            transition: all 0.3s ease;
            border: 1px solid #dee2e6;
        }

        .income-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            background: #e9ecef;
        }

        .income-label {
            font-size: 1.1em;
            font-weight: 600;
            color: #4a90e2;
            min-width: 80px;
        }

        .income-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            flex: 1;
            text-align: right;
        }

        .income-coin-box {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            min-width: 120px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .income-coin-box:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: #4a90e2;
        }

        .big-coin {
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 10px auto;
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .gold-coin {
            border: 3px solid #ffd700;
            background: linear-gradient(145deg, #fff8dc, #ffd700);
        }

        .silver-coin {
            border: 3px solid #c0c0c0;
            background: linear-gradient(145deg, #f5f5f5, #c0c0c0);
        }

        .copper-coin {
            border: 3px solid #cd7f32;
            background: linear-gradient(145deg, #f4e4bc, #cd7f32);
        }

        .coin-amount {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="./images/–¥—Ä–∞–∫–æ–Ω.gif" alt="–î—Ä–∞–∫–æ–Ω">
    </div>
    <h1>–õ–æ–≥–æ–∑–∞–≤—Ä:)</h1>
    <div class="tabs">
        <div class="tab active" onclick="showTab('log')">
            <i class="fas fa-file-alt"></i>
            –õ–æ–≥
        </div>
        <div class="tab" onclick="showTab('attacks')">
            <i class="fas fa-khanda"></i>
            –ù–∞–ø–∞–¥–µ–Ω–∏—è
        </div>
        <div class="tab" onclick="showTab('money')">
            <i class="fas fa-coins"></i>
            –î–µ–Ω—å–≥–∏
        </div>
        <div class="tab" onclick="showTab('items')">
            <i class="fas fa-box"></i>
            –ü—Ä–µ–¥–º–µ—Ç—ã
        </div>
        <div class="tab" onclick="showTab('records')">
            <i class="fas fa-trophy"></i>
            –†–µ–∫–æ—Ä–¥—ã
        </div>
        <div class="tab" onclick="showTab('history')">
            <i class="fas fa-history"></i>
            –ò—Å—Ç–æ—Ä–∏—è
        </div>
        <div class="tab" onclick="showTab('drop')">
            <i class="fas fa-gem"></i>
            –î—Ä–æ–ø
        </div>
        <div class="tab" onclick="showTab('stats')">
            <i class="fas fa-chart-bar"></i>
            –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        </div>
    </div>
    <div id="log" class="tab-content active">
        <div class="input-controls">
            <button onclick="insertLog()" class="btn-secondary">
                <i class="fas fa-paste"></i>
                –í—Å—Ç–∞–≤–∏—Ç—å
            </button>
            <button onclick="clearLog()" class="btn-secondary">
                <i class="fas fa-trash"></i>
                –û—á–∏—Å—Ç–∏—Ç—å
            </button>
        </div>
        <textarea id="logInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥ –∑–¥–µ—Å—å..."></textarea>
    </div>
    <div id="attacks" class="tab-content">
        <button onclick="countAttacks()">–ü–æ—Å—á–∏—Ç–∞—Ç—å –Ω–∞–ø–∞–¥–µ–Ω–∏—è</button>
    </div>
    <div id="money" class="tab-content">
        <button onclick="countMoney()">–ü–æ—Å—á–∏—Ç–∞—Ç—å –¥–µ–Ω—å–≥–∏</button>
    </div>
    <div id="items" class="tab-content">
        <button class="spoiler-button" onclick="toggleSpoiler('itemFilter')">–ü–æ–∫–∞–∑–∞—Ç—å/–°–∫—Ä—ã—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø—Ä–µ–¥–º–µ—Ç–æ–≤</button>
        <div id="itemFilter" class="spoiler-content">
            <div class="checkbox-group" id="itemCheckboxGroup">
                <!-- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–¥–µ—Å—å -->
            </div>
            <div class="add-item">
                <input type="text" id="newItemInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞">
                <button onclick="addItem()">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç</button>
                <button onclick="clearStorage()">–û—á–∏—Å—Ç–∏—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ</button>
                <input type="file" id="fileInput" accept=".txt" onchange="importItems(event)">
            </div>
            <button onclick="toggleSelectAll()">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ/–°–Ω—è—Ç—å –≤—Å–µ</button>
            <button onclick="removeSelectedItems()">–£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ</button> <!-- –ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ -->
        </div>
        <button onclick="countItems()">–ü–æ—Å—á–∏—Ç–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç—ã</button>
        <button onclick="analyzeItemDrops()">üìä –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        <button onclick="resetAdvancedStats()" class="btn-reset">–°–±—Ä–æ—Å–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
        

    </div>
    <div id="drop" class="tab-content">
        <h2>–ê–Ω–∞–ª–∏–∑ –¥—Ä–æ–ø–∞</h2>
        <div class="drop-management">
            <div class="drop-controls">
                <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤</h3>
                <div class="add-drop-item">
                    <input type="text" id="dropItemName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞">
                    <div class="currency-input">
                        <div class="currency-field">
                            <img src="./images/1.svg" class="coin" alt="–ó–æ–ª–æ—Ç–æ">
                            <input type="number" id="dropItemGold" placeholder="0" min="0" value="0">
                        </div>
                        <div class="currency-field">
                            <img src="./images/2.svg" class="coin" alt="–°–µ—Ä–µ–±—Ä–æ">
                            <input type="number" id="dropItemSilver" placeholder="0" min="0" value="0">
                        </div>
                        <div class="currency-field">
                            <img src="./images/3.svg" class="coin" alt="–ú–µ–¥—å">
                            <input type="number" id="dropItemCopper" placeholder="0" min="0" value="0">
                        </div>
                    </div>
                    <button onclick="addDropItem()">
                        <i class="fas fa-plus"></i>
                        –î–æ–±–∞–≤–∏—Ç—å
                    </button>
                </div>
                <div class="drop-actions">
                    <button onclick="exportDropData()">
                        <i class="fas fa-download"></i>
                        –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
                    </button>
                    <input type="file" id="dropImportFile" accept=".json" style="display: none;" onchange="importDropData(event)">
                    <button onclick="document.getElementById('dropImportFile').click()">
                        <i class="fas fa-upload"></i>
                        –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
                    </button>
                    <button onclick="clearDropData()">
                        <i class="fas fa-trash"></i>
                        –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ
                    </button>
                </div>
            </div>
            
            <div class="drop-items-list">
                <button class="spoiler-button" onclick="toggleSpoiler('dropItemsList')">
                    <i class="fas fa-list"></i>
                    –ü–æ–∫–∞–∑–∞—Ç—å/–°–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ —Å —Ü–µ–Ω–∞–º–∏
                </button>
                <div id="dropItemsList" class="spoiler-content"></div>
            </div>
            
            <div class="drop-analysis">
                <h3>–ê–Ω–∞–ª–∏–∑ –¥—Ä–æ–ø–∞ –∏–∑ –ª–æ–≥–∞</h3>
                <button onclick="analyzeDrop()">
                    <i class="fas fa-search"></i>
                    –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥—Ä–æ–ø
                </button>
                <div id="dropResults"></div>
            </div>
        </div>
    </div>
    <div id="records" class="tab-content">
        <h2>–†–µ–∫–æ—Ä–¥—ã</h2>
        <div class="records-container">
            <div class="records-section">
                <h3>–†–µ–∫–æ—Ä–¥—ã –Ω–∞–ø–∞–¥–µ–Ω–∏–π</h3>
                <div id="attack-records"></div>
                <button onclick="clearRecords('attack-records')">–°–±—Ä–æ—Å–∏—Ç—å —Ä–µ–∫–æ—Ä–¥—ã –Ω–∞–ø–∞–¥–µ–Ω–∏–π</button>
            </div>
            <div class="records-section">
                <h3>–†–µ–∫–æ—Ä–¥—ã –¥–µ–Ω–µ–≥</h3>
                <div id="money-records"></div>
                <button onclick="clearRecords('money-record')">–°–±—Ä–æ—Å–∏—Ç—å —Ä–µ–∫–æ—Ä–¥—ã –¥–µ–Ω–µ–≥</button>
            </div>
        </div>
    </div>
    <div id="history" class="tab-content">
        <h2>–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ—Ä–µ–Ω–∏–π</h2>
        <div id="history-container">
            <!-- –ò—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–¥–µ—Å—å -->
        </div>
        <button onclick="clearHistory()">–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
    </div>
    <div id="stats" class="tab-content">
        <h2>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
        <div class="stats-container">
            <div class="stats-section">
                <h3>–ú–æ–Ω—Å—Ç—Ä—ã</h3>
                <div id="total-monsters-stats">
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p>
                </div>
            </div>
            <div class="stats-section">
                <h3>–î–µ–Ω—å–≥–∏</h3>
                <div id="total-money-stats">
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p>
                </div>
            </div>
            <div class="stats-section">
                <h3>–ü—Ä–µ–¥–º–µ—Ç—ã</h3>
                <div id="total-items-stats">
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p>
                </div>
            </div>
        </div>
        
        <div class="drop-stats-section">
            <h2>–û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å</h2>
            <div id="total-profit-stats">
                <div class="drop-summary">
                    <div class="drop-summary-text">
                        <strong>üí∞ –î–µ–Ω—å–≥–∏ —Å –º–æ–Ω—Å—Ç—Ä–æ–≤:</strong> <span id="monster-profit-amount">0 <img src="./images/3.svg" class="coin" alt="–ú–µ–¥—å"></span><br>
                        <strong>üéí –î–µ–Ω—å–≥–∏ —Å –¥—Ä–æ–ø–∞:</strong> <span id="drop-profit-amount">0 <img src="./images/3.svg" class="coin" alt="–ú–µ–¥—å"></span>
                    </div>
                </div>
                
                <!-- –ö—Ä–∞—Å–∏–≤–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±—â–µ–≥–æ –¥–æ—Ö–æ–¥–∞ -->
                <div class="total-income-display">
                    <div class="income-header">
                        <h3>üìä –û–±—â–∏–π –¥–æ—Ö–æ–¥</h3>
                    </div>
                    <div class="income-row">
                        <div class="income-item">
                            <img src="./images/1.svg" class="coin" alt="–ó–æ–ª–æ—Ç–æ">
                            <span class="income-value" id="total-gold-amount">0</span>
                        </div>
                        <div class="income-item">
                            <img src="./images/2.svg" class="coin" alt="–°–µ—Ä–µ–±—Ä–æ">
                            <span class="income-value" id="total-silver-amount">0</span>
                        </div>
                        <div class="income-item">
                            <img src="./images/3.svg" class="coin" alt="–ú–µ–¥—å">
                            <span class="income-value" id="total-copper-amount">0</span>
                        </div>
                    </div>
                </div>
                
                <button onclick="resetTotalProfit()" class="btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏–±—ã–ª–∏</button>
            </div>
        </div>
        
        <div class="drop-stats-section">
            <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –¥—Ä–æ–ø–∞</h2>
            <div id="total-drop-stats">
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥—Ä–æ–ø–∞...</p>
            </div>
        </div>
        
        <!-- –ë–ª–æ–∫ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
        <div id="detailed-stats-section" style="display: none;">
            <h2>üìä –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º</h2>
            <div id="detailed-stats-display"></div>
        </div>
        
        <button onclick="clearAllStats()">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
    </div>
    <div id="results"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            loadRecords();
            loadHistory();
            loadStats();
            loadDropItems();
            loadDropStats();
            loadDetailedStats(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateTotalProfitDisplay(); // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ–±—â–µ–π –ø—Ä–∏–±—ã–ª–∏
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—é –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π
            document.getElementById('history-container').addEventListener('dblclick', handleHistoryEntryDblClick);
        });

        function showTab(tabId) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            // –ë–µ–∑–æ–ø–∞—Å–Ω–æ —É–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã
            tabs.forEach(tab => {
                if (tab && tab.classList) {
                    tab.classList.remove('active');
                }
            });
            contents.forEach(content => {
                if (content && content.classList) {
                    content.classList.remove('active');
                }
            });
            
            // –ë–µ–∑–æ–ø–∞—Å–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã
            const activeTab = document.querySelector(`.tab[onclick="showTab('${tabId}')"]`);
            const activeContent = document.getElementById(tabId);
            
            if (activeTab && activeTab.classList) {
                activeTab.classList.add('active');
            }
            if (activeContent && activeContent.classList) {
                activeContent.classList.add('active');
            }
        }

        function toggleSpoiler(spoilerId) {
            const spoilerContent = document.getElementById(spoilerId);
            spoilerContent.style.display = spoilerContent.style.display === 'none' || spoilerContent.style.display === '' ? 'block' : 'none';
        }

        function countAttacks() {
            const logInput = document.getElementById('logInput').value;
            const attackCounts = parseLog(logInput, /–í—ã —Å–æ–≤–µ—Ä—à–∏–ª–∏ –Ω–∞–ø–∞–¥–µ–Ω–∏–µ –Ω–∞ (.+?)\s*\[/g);
            displayResults(attackCounts, '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞–ø–∞–¥–µ–Ω–∏–π:', true);
        }

        function countMoney() {
            const logInput = document.getElementById('logInput').value;
            const logLines = logInput.split('\n');
            
            // –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –¥–µ–Ω–µ–≥ (—Å —Ç—Ä–µ–º—è —á–∏—Å–ª–∞–º–∏ - –∑–æ–ª–æ—Ç–æ, —Å–µ—Ä–µ–±—Ä–æ, –º–µ–¥—å)
            const goldSilverCopperPattern = /–í—ã –ø–æ–ª—É—á–∏–ª–∏:\s*(\d+)\s+(\d+)\s+(\d+)/;
            
            // –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –¥–µ–Ω–µ–≥ (—Å –¥–≤—É–º—è —á–∏—Å–ª–∞–º–∏ - —Å–µ—Ä–µ–±—Ä–æ, –º–µ–¥—å)
            const silverCopperPattern = /–í—ã –ø–æ–ª—É—á–∏–ª–∏:\s*(\d+)\s+(\d+)(?!\s+\d)/;
            
            // –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –º–∞–≥–∏—á–µ—Å–∫–∏—Ö –¥–µ–Ω–µ–≥ (—Å —Ç—Ä–µ–º—è —á–∏—Å–ª–∞–º–∏ - –∑–æ–ª–æ—Ç–æ, —Å–µ—Ä–µ–±—Ä–æ, –º–µ–¥—å)
            const magicGoldSilverCopperPattern = /–ë–ª–∞–≥–æ–¥–∞—Ä—è –º–∞–≥–∏—á–µ—Å–∫–∏–º —ç—Ñ—Ñ–µ–∫—Ç–∞–º, –≤—ã —Å—É–º–µ–ª–∏ –æ–±–æ–≥–∞—Ç–∏—Ç—å—Å—è –µ—â–µ –Ω–∞\s*(\d+)\s+(\d+)\s+(\d+)/;
            
            // –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –º–∞–≥–∏—á–µ—Å–∫–∏—Ö –¥–µ–Ω–µ–≥ (—Å –¥–≤—É–º—è —á–∏—Å–ª–∞–º–∏ - —Å–µ—Ä–µ–±—Ä–æ, –º–µ–¥—å)
            const magicSilverCopperPattern = /–ë–ª–∞–≥–æ–¥–∞—Ä—è –º–∞–≥–∏—á–µ—Å–∫–∏–º —ç—Ñ—Ñ–µ–∫—Ç–∞–º, –≤—ã —Å—É–º–µ–ª–∏ –æ–±–æ–≥–∞—Ç–∏—Ç—å—Å—è –µ—â–µ –Ω–∞\s*(\d+)\s+(\d+)(?!\s+\d)/;
            
            // –ü–æ–¥—Å—á–µ—Ç –æ–±—ã—á–Ω—ã—Ö –¥–µ–Ω–µ–≥
            const totalCopperGSC = calculateTotalCopper(logLines, goldSilverCopperPattern, true);
            const totalCopperSC = calculateTotalCopper(logLines, silverCopperPattern, false);
            const totalCopper = totalCopperGSC + totalCopperSC;
            
            // –ü–æ–¥—Å—á–µ—Ç –º–∞–≥–∏—á–µ—Å–∫–∏—Ö –¥–µ–Ω–µ–≥
            const magicTotalCopperGSC = calculateTotalCopper(logLines, magicGoldSilverCopperPattern, true);
            const magicTotalCopperSC = calculateTotalCopper(logLines, magicSilverCopperPattern, false);
            const magicTotalCopper = magicTotalCopperGSC + magicTotalCopperSC;
            
            const combinedTotalCopper = totalCopper + magicTotalCopper;

            const moneyResult = formatMoneyResult(totalCopper, '–í—ã–±–∏—Ç–æ —Å –±–æ–µ–≤') +
                               formatMoneyResult(magicTotalCopper, '–ë–ª–∞–≥–æ–¥–∞—Ä—è –º–∞–≥–∏—á–µ—Å–∫–∏–º —ç—Ñ—Ñ–µ–∫—Ç–∞–º') +
                               formatMoneyResult(combinedTotalCopper, '–ò—Ç–æ–≥–æ');

            displayMoneyResults(moneyResult, '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–¥—Å—á–µ—Ç–∞ –¥–µ–Ω–µ–≥:');
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫ –æ–±—â–µ–π –ø—Ä–∏–±—ã–ª–∏ —Ç–æ–ª—å–∫–æ –æ—Ç –ø–æ–¥—Å—á–µ—Ç–∞ –¥–µ–Ω–µ–≥
            addToTotalProfit(combinedTotalCopper, 'monster');
        }

        function countItems() {
            const logInput = document.getElementById('logInput').value;
            const selectedItems = Array.from(document.querySelectorAll('.item-checkbox:checked')).map(checkbox => checkbox.value);
            
            if (selectedItems.length === 0) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–µ–¥–º–µ—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞.');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            const itemCounts = {};
            
            // –†–∞–∑–±–∏–≤–∞–µ–º –ª–æ–≥ –Ω–∞ —Å—Ç—Ä–æ–∫–∏
            const logLines = logInput.split('\n');
            
            // –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º —Å—Ç—Ä–æ–∫–∏ –ª–æ–≥–∞
            logLines.forEach(line => {
                // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ–Ω –≤ —Å—Ç—Ä–æ–∫–µ
                selectedItems.forEach(item => {
                    // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –ø—Ä–µ–¥–º–µ—Ç–∞
                    const escapedItem = item.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
                    
                    // –°–æ–∑–¥–∞–µ–º —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞
                    const itemRegex = new RegExp(`${escapedItem}\\s+(\\d+)\\s+—à—Ç`, 'g');
                    
                    // –ü–æ–∏—Å–∫ –ø—Ä–µ–¥–º–µ—Ç–∞ –≤ —Å—Ç—Ä–æ–∫–µ
                    let match;
                    while ((match = itemRegex.exec(line)) !== null) {
                        // –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
                        const quantity = parseInt(match[1]) || 1;
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –∫ –æ–±—â–µ–º—É —Å—á–µ—Ç—É
                        itemCounts[item] = (itemCounts[item] || 0) + quantity;
                    }
                });
            });
            
            displayItemResults(itemCounts);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –¥—Ä–æ–ø—É
        function analyzeItemDrops() {
            const logInput = document.getElementById('logInput').value;
            const selectedItems = Array.from(document.querySelectorAll('.item-checkbox:checked')).map(checkbox => checkbox.value);
            
            if (selectedItems.length === 0) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–µ–¥–º–µ—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.');
                return;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–æ—ë–≤
            updateTotalBattles();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–∑ localStorage
            let detailedStats = JSON.parse(localStorage.getItem('detailedDropStats') || '{}');
            
            // –†–∞–∑–±–∏–≤–∞–µ–º –ª–æ–≥ –Ω–∞ —Å—Ç—Ä–æ–∫–∏
            const logLines = logInput.split('\n');
            
            // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ –∞–ª–≥–æ—Ä–∏—Ç–º —á—Ç–æ –∏ –≤ countItems()
            selectedItems.forEach(item => {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –ø—Ä–µ–¥–º–µ—Ç–∞, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
                if (!detailedStats[item]) {
                    detailedStats[item] = {
                        total: 0,
                        count: 0,
                        drops: [],
                        freqTable: {},
                        min: Infinity,
                        max: 0
                    };
                }
                
                // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –ø—Ä–µ–¥–º–µ—Ç–∞
                const escapedItem = item.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
                
                // –°–æ–∑–¥–∞–µ–º —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ (—Ç–æ—Ç –∂–µ —á—Ç–æ –∏ –≤ countItems)
                const itemRegex = new RegExp(`${escapedItem}\\s+(\\d+)\\s+—à—Ç`, 'g');
                
                // –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º —Å—Ç—Ä–æ–∫–∏ –ª–æ–≥–∞
                logLines.forEach(line => {
                    let match;
                    while ((match = itemRegex.exec(line)) !== null) {
                        const quantity = parseInt(match[1]) || 1;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                        detailedStats[item].total += quantity;
                        detailedStats[item].count += 1;
                        detailedStats[item].drops.push(quantity);
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º min/max
                        detailedStats[item].min = Math.min(detailedStats[item].min, quantity);
                        detailedStats[item].max = Math.max(detailedStats[item].max, quantity);
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É —á–∞—Å—Ç–æ—Ç
                        if (!detailedStats[item].freqTable[quantity]) {
                            detailedStats[item].freqTable[quantity] = 0;
                        }
                        detailedStats[item].freqTable[quantity] += 1;
                    }
                });
                
                // –ï—Å–ª–∏ min –æ—Å—Ç–∞–ª—Å—è Infinity (–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö), —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤ 0
                if (detailedStats[item].min === Infinity) {
                    detailedStats[item].min = 0;
                }
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            localStorage.setItem('detailedDropStats', JSON.stringify(detailedStats));
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            displayDetailedStats(detailedStats, selectedItems);
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            showTab('statistics');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function displayDetailedStats(stats, selectedItems) {
            const section = document.getElementById('detailed-stats-section');
            const display = document.getElementById('detailed-stats-display');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∏–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ
            const allItems = Object.keys(stats).filter(item => stats[item].count > 0);
            
            if (allItems.length === 0) {
                section.style.display = 'none';
                return;
            }
            
            let html = '';
            const maxVisible = 5; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ 5 –ø—Ä–µ–¥–º–µ—Ç–æ–≤, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–¥ —Å–ø–æ–π–ª–µ—Ä–æ–º
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã
            const visibleItems = allItems.slice(0, maxVisible);
            const hiddenItems = allItems.slice(maxVisible);
            
            visibleItems.forEach(item => {
                html += generateItemStatsHTML(item, stats[item]);
            });
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–∫—Ä—ã—Ç—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã, –¥–æ–±–∞–≤–ª—è–µ–º —Å–ø–æ–π–ª–µ—Ä
            if (hiddenItems.length > 0) {
                html += `
                    <div class="stats-spoiler">
                        <div class="spoiler-header" onclick="toggleSpoiler('more-items-spoiler')">
                            <h4>üìã –ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë ${hiddenItems.length} –ø—Ä–µ–¥–º–µ—Ç–æ–≤</h4>
                            <span class="spoiler-arrow">‚ñº</span>
                        </div>
                        <div id="more-items-spoiler" class="spoiler-content">
                `;
                
                hiddenItems.forEach(item => {
                    html += generateItemStatsHTML(item, stats[item]);
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            display.innerHTML = html;
            section.style.display = 'block';
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ HTML –æ–¥–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞
        function generateItemStatsHTML(item, itemStats) {
            if (!itemStats || itemStats.count === 0) {
                return `<div class="stat-item">
                    <div class="stat-item-header">
                        <img src="./images/${item}.gif" class="item-image" style="width: 30px; height: 30px;" onerror="this.style.display='none'">
                        <h4>${item}</h4>
                    </div>
                    <p>–î–∞–Ω–Ω—ã—Ö –ø–æ —ç—Ç–æ–º—É –ø—Ä–µ–¥–º–µ—Ç—É –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
                </div>`;
            }
            
            // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
            const avg = itemStats.count > 0 ? (itemStats.total / itemStats.count).toFixed(2) : 0;
            
            // –í—ã—á–∏—Å–ª—è–µ–º Drop Rate
            const totalBattles = getTotalBattlesFromStats();
            const dropRate = totalBattles > 0 ? (itemStats.count / totalBattles * 100).toFixed(2) : 0;
            const dropRateText = totalBattles > 0 ? 
                `${dropRate}% (${itemStats.count} –∏–∑ ${totalBattles} –±–æ—ë–≤)` : 
                '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –±–æ—è—Ö';
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–∞–±–ª–∏—Ü—É —á–∞—Å—Ç–æ—Ç
            const totalDrops = Object.values(itemStats.freqTable).reduce((a, b) => a + b, 0);
            const freqEntriesArray = Object.entries(itemStats.freqTable)
                .sort((a, b) => parseInt(a[0]) - parseInt(b[0]))
                .map(([qty, count]) => {
                    const percent = ((count / totalDrops) * 100).toFixed(1);
                    return `${qty} —à—Ç: ${count} —Ä–∞–∑ (${percent}%)`;
                });
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –∫—Ä–∞—Å–∏–≤–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã
            let freqEntries;
            if (freqEntriesArray.length === 0) {
                freqEntries = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
            } else if (freqEntriesArray.length === 1) {
                // –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∂–∏—Ä–Ω—ã–º –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É
                const [qty, count] = Object.entries(itemStats.freqTable)[0];
                const percent = ((count / totalDrops) * 100).toFixed(1);
                freqEntries = `<strong>${qty} —à—Ç: ${count} —Ä–∞–∑ (${percent}%)</strong>`;
            } else {
                // –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é –∂–∏—Ä–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π
                freqEntries = Object.entries(itemStats.freqTable)
                    .sort((a, b) => parseInt(a[0]) - parseInt(b[0]))
                    .map(([qty, count]) => {
                        const percent = ((count / totalDrops) * 100).toFixed(1);
                        return `<strong>${qty} —à—Ç: ${count} —Ä–∞–∑ (${percent}%)</strong>`;
                    })
                    .join('<br>');
            }
            
            return `
                <div class="stat-item">
                    <div class="stat-item-header">
                        <img src="./images/${item}.gif" class="item-image" style="width: 30px; height: 30px;" onerror="this.style.display='none'">
                        <h4>${item}</h4>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <strong>–í—Å–µ–≥–æ:</strong> ${itemStats.total}
                        </div>
                        <div class="stat-box">
                            <strong>–í—ã–ø–∞–¥–µ–Ω–∏–π:</strong> ${itemStats.count}
                        </div>
                        <div class="stat-box">
                            <strong>–°—Ä–µ–¥–Ω–µ–µ:</strong> ${avg}
                        </div>
                        <div class="stat-box">
                            <strong>–ú–∏–Ω:</strong> ${itemStats.min}, <strong>–ú–∞–∫—Å:</strong> ${itemStats.max}
                        </div>
                        <div class="stat-box drop-rate-box">
                            <strong>–ß–∞—Å—Ç–æ—Ç–∞ –¥—Ä–æ–ø–∞ –≤ –±–æ—è—Ö:</strong> ${dropRateText}
                        </div>
                    </div>
                    <div class="frequency-table">
                        <h5 style="color: #4a90e2; font-weight: bold; margin-top: 10px; margin-bottom: 8px;">–ß–∞—Å—Ç–æ—Ç–∞ –≤—ã–ø–∞–¥–µ–Ω–∏–π:</h5>
                        <div style="margin-left: 10px; line-height: 1.6;">${freqEntries || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</div>
                    </div>
                </div>
            `;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–æ—ë–≤ —Å –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ–º
        function getTotalBattlesFromStats() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–∞–Ω–µ–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
            let savedTotalBattles = parseInt(localStorage.getItem('totalBattles') || '0');
            return savedTotalBattles;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–æ—ë–≤
        function updateTotalBattles() {
            const logInput = document.getElementById('logInput');
            if (!logInput || !logInput.value.trim()) {
                return 0;
            }
            
            // –°—á—ë—Ç—á–∏–∫ –±–æ—ë–≤ –∑–∞ —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é
            let battlesThisSession = (logInput.value.match(/–ù–∞—á–∞–ª—Å—è –±–æ–π/g) || []).length;
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–Ω–µ–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
            let savedTotalBattles = parseInt(localStorage.getItem('totalBattles') || '0');
            
            // –°—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ
            let updatedTotalBattles = savedTotalBattles + battlesThisSession;
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
            localStorage.setItem('totalBattles', updatedTotalBattles.toString());
            
            return updatedTotalBattles;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function resetAdvancedStats() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å—é –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                // –û—á–∏—â–∞–µ–º localStorage
                localStorage.removeItem('detailedDropStats');
                localStorage.removeItem('totalBattles');
                
                // –ë–µ–∑–æ–ø–∞—Å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º –±–ª–æ–∫ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                const section = document.getElementById('detailed-stats-section');
                if (section && section.style) {
                    section.style.display = 'none';
                }
                
                // –ë–µ–∑–æ–ø–∞—Å–Ω–æ –æ—á–∏—â–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                const display = document.getElementById('detailed-stats-display');
                if (display && display.innerHTML !== undefined) {
                    display.innerHTML = '';
                }
                
                alert('–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–±—Ä–æ—à–µ–Ω–∞.');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function loadDetailedStats() {
            const stats = JSON.parse(localStorage.getItem('detailedDropStats') || '{}');
            if (Object.keys(stats).length > 0) {
                displayDetailedStats(stats, []);
            }
        }

        function toggleSelectAll() {
            const checkboxes = document.querySelectorAll('.item-checkbox');
            const allChecked = Array.from(checkboxes).every(checkbox => checkbox.checked);
            checkboxes.forEach(checkbox => checkbox.checked = !allChecked);
        }

        function clearStorage() {
            localStorage.removeItem('itemSettings');
            document.getElementById('itemCheckboxGroup').innerHTML = '';
            alert('–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –æ—á–∏—â–µ–Ω–æ.');
        }

        function addItem() {
            const newItemInput = document.getElementById('newItemInput');
            const newItem = newItemInput.value.trim();
            if (newItem && !isItemExists(newItem.toLowerCase())) {
                const checkboxGroup = document.getElementById('itemCheckboxGroup');
                const label = document.createElement('label');
                label.innerHTML = `<input type="checkbox" class="item-checkbox" value="${newItem}"> ${newItem}`;
                checkboxGroup.appendChild(label);
                newItemInput.value = '';
                saveSettings();
            } else {
                alert('–≠—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ.');
            }
        }

        function removeSelectedItems() {
            const checkboxes = document.querySelectorAll('.item-checkbox:checked');
            checkboxes.forEach(checkbox => {
                const label = checkbox.parentElement;
                label.remove();
            });
            saveSettings();
        }

        function isItemExists(item) {
            const checkboxes = document.querySelectorAll('.item-checkbox');
            return Array.from(checkboxes).some(checkbox => checkbox.value.toLowerCase() === item);
        }

        function importItems(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                const lines = content.split('\n');
                const checkboxGroup = document.getElementById('itemCheckboxGroup');
                
                lines.forEach(line => {
                    const item = line.trim();
                    if (item && !isItemExists(item.toLowerCase())) {
                        const label = document.createElement('label');
                        label.innerHTML = `<input type="checkbox" class="item-checkbox" value="${item}"> ${item}`;
                        checkboxGroup.appendChild(label);
                    }
                });
                
                saveSettings();
                event.target.value = '';
            };
            reader.readAsText(file);
        }

        function saveSettings() {
            const checkboxes = document.querySelectorAll('.item-checkbox');
            const items = Array.from(checkboxes).map(checkbox => checkbox.value);
            localStorage.setItem('itemSettings', JSON.stringify(items));
        }

        function loadSettings() {
            try {
                const savedItems = JSON.parse(localStorage.getItem('itemSettings')) || [];
                const checkboxGroup = document.getElementById('itemCheckboxGroup');
                
                savedItems.forEach(item => {
                    const label = document.createElement('label');
                    label.innerHTML = `<input type="checkbox" class="item-checkbox" value="${item}"> ${item}`;
                    checkboxGroup.appendChild(label);
                });
            } catch (error) {
                console.error('Error loading settings:', error);
                localStorage.removeItem('itemSettings');
            }
        }

        function parseLog(log, pattern) {
            const counts = {};
            let match;
            
            if (pattern.global) {
                // For global regex patterns
                while ((match = pattern.exec(log)) !== null) {
                    const name = match[1].trim();
                    const quantity = match[2] ? parseInt(match[2]) : 1;
                    counts[name] = (counts[name] || 0) + quantity;
                }
            } else {
                // For non-global regex patterns
                const lines = log.split('\n');
                for (const line of lines) {
                    match = line.match(pattern);
                    if (match) {
                        const name = match[1].trim();
                        const quantity = match[2] ? parseInt(match[2]) : 1;
                        counts[name] = (counts[name] || 0) + quantity;
                    }
                }
            }
            
            return counts;
        }

        function calculateTotalCopper(logLines, pattern, hasGold = false) {
            let totalCopper = 0;
            
            for (const line of logLines) {
                const match = line.match(pattern);
                if (match) {
                    if (hasGold) {
                        // –ï—Å–ª–∏ —ç—Ç–æ —Ñ–æ—Ä–º–∞—Ç —Å –∑–æ–ª–æ—Ç–æ–º, —Å–µ—Ä–µ–±—Ä–æ–º –∏ –º–µ–¥—å—é
                        const gold = parseInt(match[1]) || 0;
                        const silver = parseInt(match[2]) || 0;
                        const copper = parseInt(match[3]) || 0;
                        
                        totalCopper += gold * 10000 + silver * 100 + copper;
                    } else {
                        // –ï—Å–ª–∏ —ç—Ç–æ —Ñ–æ—Ä–º–∞—Ç —Ç–æ–ª—å–∫–æ —Å —Å–µ—Ä–µ–±—Ä–æ–º –∏ –º–µ–¥—å—é
                        const silver = parseInt(match[1]) || 0;
                        const copper = parseInt(match[2]) || 0;
                        
                        totalCopper += silver * 100 + copper;
                    }
                }
            }
            
            return totalCopper;
        }

        function formatMoneyResult(totalCopper, label) {
            const gold = Math.floor(totalCopper / 10000);
            const remainder = totalCopper % 10000;
            const silver = Math.floor(remainder / 100);
            const copper = remainder % 100;

            return `<div>${label}: ${gold} <img src="./images/1.svg" class="coin" alt="–∑–æ–ª–æ—Ç–æ">, ${silver} <img src="./images/2.svg" class="coin" alt="—Å–µ—Ä–µ–±—Ä–æ">, ${copper} <img src="./images/3.svg" class="coin" alt="–º–µ–¥—å"></div>`;
        }

        function displayResults(results, title, includeImages = false) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `<h2 style="font-weight: bold;">${title}</h2>`; // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∂–∏—Ä–Ω—ã–º
            const container = document.createElement('div');
            container.style.display = 'flex';
            container.style.flexWrap = 'wrap';
            
            let row = document.createElement('div');
            row.style.display = 'flex';
            row.style.width = '100%';

            let count = 0;

            for (const [key, value] of Object.entries(results)) {
                const itemDiv = document.createElement('div');
                itemDiv.style.flex = '1 0 30%'; // –ó–∞–Ω–∏–º–∞–µ—Ç 30% —à–∏—Ä–∏–Ω—ã, —á—Ç–æ–±—ã –≤–º–µ—â–∞—Ç—å 3 –ø—Ä–µ–¥–º–µ—Ç–∞ –≤ —Å—Ç—Ä–æ–∫–µ
                itemDiv.style.boxSizing = 'border-box';
                itemDiv.style.padding = '10px'; // –û—Ç—Å—Ç—É–ø—ã –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
                
                // –£—Å–ª–æ–≤–∏–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                const imageSize = title === '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞–ø–∞–¥–µ–Ω–∏–π:' ? '150px' : '50px';
                itemDiv.innerHTML = `${includeImages ? `<img src="./images/${key}.gif" class="item-image" style="width: ${imageSize}; height: ${imageSize};" alt="${key}">` : ''} ${key}: ${value}`;
                
                row.appendChild(itemDiv);
                count++;

                // –ï—Å–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–æ 3 –ø—Ä–µ–¥–º–µ—Ç–∞, –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é
                if (count % 3 === 0) {
                    container.appendChild(row);
                    row = document.createElement('div');
                    row.style.display = 'flex';
                    row.style.width = '100%';
                }
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —ç–ª–µ–º–µ–Ω—Ç—ã, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
            if (count % 3 !== 0) {
                container.appendChild(row);
            }

            resultsDiv.appendChild(container);
        }

        function displayMoneyResults(results, title) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `<h2 style="font-weight: bold;">${title}</h2>`; // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∂–∏—Ä–Ω—ã–º
            const div = document.createElement('div');
            div.className = 'results-column';
            div.innerHTML = results;
            resultsDiv.appendChild(div);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–æ–≤ –¥–µ–Ω–µ–≥ –∏ –∏—Å—Ç–æ—Ä–∏–∏
            updateMoneyRecords(results);
            addHistoryEntry('money', results);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è displayResults –¥–ª—è —É—á–µ—Ç–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤ –∏ –∏—Å—Ç–æ—Ä–∏–∏
        function displayResults(results, title, includeImages = false) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `<h2 style="font-weight: bold;">${title}</h2>`; // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∂–∏—Ä–Ω—ã–º
            const container = document.createElement('div');
            container.style.display = 'flex';
            container.style.flexWrap = 'wrap';
            
            let row = document.createElement('div');
            row.style.display = 'flex';
            row.style.width = '100%';

            let count = 0;

            for (const [key, value] of Object.entries(results)) {
                const itemDiv = document.createElement('div');
                itemDiv.style.flex = '1 0 30%'; // –ó–∞–Ω–∏–º–∞–µ—Ç 30% —à–∏—Ä–∏–Ω—ã, —á—Ç–æ–±—ã –≤–º–µ—â–∞—Ç—å 3 –ø—Ä–µ–¥–º–µ—Ç–∞ –≤ —Å—Ç—Ä–æ–∫–µ
                itemDiv.style.boxSizing = 'border-box';
                itemDiv.style.padding = '10px'; // –û—Ç—Å—Ç—É–ø—ã –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
                const imageSize = title === '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞–ø–∞–¥–µ–Ω–∏–π:' ? '150px' : '50px'; // –£—Å–ª–æ–≤–∏–µ –¥–ª—è —Ä–∞–∑–º–µ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                itemDiv.innerHTML = `${includeImages ? `<img src="./images/${key}.gif" class="item-image" style="width: ${imageSize}; height: ${imageSize};" alt="${key}">` : ''} ${key}: ${value}`;
                
                row.appendChild(itemDiv);
                count++;

                // –ï—Å–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–æ 3 –ø—Ä–µ–¥–º–µ—Ç–∞, –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é
                if (count % 3 === 0) {
                    container.appendChild(row);
                    row = document.createElement('div');
                    row.style.display = 'flex';
                    row.style.width = '100%';
                }
            }

                        // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —ç–ª–µ–º–µ–Ω—Ç—ã, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
            if (count % 3 !== 0) {
                container.appendChild(row);
            }

            resultsDiv.appendChild(container);
            
            // –ï—Å–ª–∏ —ç—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞–ø–∞–¥–µ–Ω–∏–π, –æ–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∫–æ—Ä–¥—ã
            if (title === '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞–ø–∞–¥–µ–Ω–∏–π:') {
                updateAttackRecords(results);
                addHistoryEntry('attacks', results);
            } else if (title === '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–¥—Å—á–µ—Ç–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤:') {
                addHistoryEntry('items', results);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–∫–æ—Ä–¥–æ–≤ –Ω–∞–ø–∞–¥–µ–Ω–∏–π
        function updateAttackRecords(results) {
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–∏—Ö —Ä–µ–∫–æ—Ä–¥–æ–≤
            const records = JSON.parse(localStorage.getItem('attack-records') || '{}');
            let updated = false;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–æ–≤
            for (const [monster, count] of Object.entries(results)) {
                if (!records[monster] || records[monster].count < count) {
                    records[monster] = {
                        count: count,
                        date: new Date().toISOString()
                    };
                    updated = true;
                }
            }
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–æ–≤ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            if (updated) {
                localStorage.setItem('attack-records', JSON.stringify(records));
                displayAttackRecords();
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–∫–æ—Ä–¥–æ–≤ –¥–µ–Ω–µ–≥
        function updateMoneyRecords(resultHTML) {
            // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –º–µ–¥–∏ –∏–∑ HTML
            const totalMatch = resultHTML.match(/–ò—Ç–æ–≥–æ: (\d+) .+?, (\d+) .+?, (\d+)/);
            const gold = parseInt(totalMatch[1]);
            const silver = parseInt(totalMatch[2]);
            const copper = parseInt(totalMatch[3]);
            const totalCopper = gold * 10000 + silver * 100 + copper;
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ–∫–æ—Ä–¥–∞
            const record = JSON.parse(localStorage.getItem('money-record') || '{"totalCopper": 0}');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–∞
            if (totalCopper > record.totalCopper) {
                record.totalCopper = totalCopper;
                record.gold = gold;
                record.silver = silver;
                record.copper = copper;
                record.date = new Date().toISOString();
                
                localStorage.setItem('money-record', JSON.stringify(record));
                displayMoneyRecords();
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∫–æ—Ä–¥–æ–≤ –Ω–∞–ø–∞–¥–µ–Ω–∏–π
        function displayAttackRecords() {
            const recordsContainer = document.getElementById('attack-records');
            recordsContainer.innerHTML = '';
            
            const records = JSON.parse(localStorage.getItem('attack-records') || '{}');
            const sortedRecords = Object.entries(records).sort((a, b) => b[1].count - a[1].count);
            
            if (sortedRecords.length === 0) {
                recordsContainer.innerHTML = '<p>–ù–µ—Ç —Ä–µ–∫–æ—Ä–¥–æ–≤</p>';
                return;
            }
            
            for (const [monster, data] of sortedRecords) {
                const recordItem = document.createElement('div');
                recordItem.className = 'record-item';
                
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)
                const img = document.createElement('img');
                img.src = `./images/${monster}.gif`;
                img.alt = monster;
                img.className = 'item-image';
                img.style.width = '150px'; // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —à–∏—Ä–∏–Ω—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                img.style.height = '150px'; // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—ã—Å–æ—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                img.onerror = () => { img.style.display = 'none'; };
                recordItem.appendChild(img);
                
                // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–∫–æ—Ä–¥–µ
                const info = document.createElement('div');
                info.className = 'record-info';
                
                const monsterName = document.createElement('div');
                monsterName.textContent = `${monster}: ${data.count}`;
                info.appendChild(monsterName);
                
                const date = document.createElement('div');
                date.className = 'record-date';
                date.textContent = new Date(data.date).toLocaleDateString();
                info.appendChild(date);
                
                recordItem.appendChild(info);
                
                // –ö–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è
                const editButton = document.createElement('button');
                editButton.innerHTML = '&#9998;'; // –ò–∫–æ–Ω–∫–∞ —Ä—É—á–∫–∏
                editButton.title = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å';
                editButton.onclick = () => editRecord('attack-records', monster);
                recordItem.appendChild(editButton);
                
                const deleteButton = document.createElement('button');
                deleteButton.innerHTML = '&#10006;'; // –ò–∫–æ–Ω–∫–∞ –∫—Ä–µ—Å—Ç–∏–∫–∞
                deleteButton.title = '–£–¥–∞–ª–∏—Ç—å';
                deleteButton.onclick = () => deleteRecord('attack-records', monster);
                recordItem.appendChild(deleteButton);
                
                recordsContainer.appendChild(recordItem);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∫–æ—Ä–¥–æ–≤ –¥–µ–Ω–µ–≥
        function displayMoneyRecords() {
            const recordsContainer = document.getElementById('money-records');
            recordsContainer.innerHTML = '';
            
            const record = JSON.parse(localStorage.getItem('money-record') || '{"totalCopper": 0}');
            
            if (record.totalCopper === 0) {
                recordsContainer.innerHTML = '<p>–ù–µ—Ç —Ä–µ–∫–æ—Ä–¥–æ–≤</p>';
                return;
            }
            
            const recordItem = document.createElement('div');
            recordItem.className = 'record-item';
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–∫–æ—Ä–¥–µ
            const info = document.createElement('div');
            info.className = 'record-info';
            
            const moneyAmount = document.createElement('div');
            moneyAmount.innerHTML = `–†–µ–∫–æ—Ä–¥: <span class="total-result">${record.gold || 0} <img src="./images/1.svg" class="coin" alt="–∑–æ–ª–æ—Ç–æ">, 
                                     ${record.silver || 0} <img src="./images/2.svg" class="coin" alt="—Å–µ—Ä–µ–±—Ä–æ">, 
                                     ${record.copper || 0} <img src="./images/3.svg" class="coin" alt="–º–µ–¥—å"></span>`;
            info.appendChild(moneyAmount);
            
            if (record.date) {
                const date = document.createElement('div');
                date.className = 'record-date';
                date.textContent = new Date(record.date).toLocaleDateString();
                info.appendChild(date);
            }
            
            recordItem.appendChild(info);
            
            // –ö–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è
            const editButton = document.createElement('button');
            editButton.innerHTML = '&#9998;'; // –ò–∫–æ–Ω–∫–∞ —Ä—É—á–∫–∏
            editButton.title = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å';
            editButton.onclick = () => editMoneyRecord();
            recordItem.appendChild(editButton);
            
            const deleteButton = document.createElement('button');
            deleteButton.innerHTML = '&#10006;'; // –ò–∫–æ–Ω–∫–∞ –∫—Ä–µ—Å—Ç–∏–∫–∞
            deleteButton.title = '–£–¥–∞–ª–∏—Ç—å';
            deleteButton.onclick = () => deleteMoneyRecord();
            recordItem.appendChild(deleteButton);
            
            recordsContainer.appendChild(recordItem);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ä–µ–∫–æ—Ä–¥–∞ –Ω–∞–ø–∞–¥–µ–Ω–∏–π
        function deleteRecord(recordType, monster) {
            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ä–µ–∫–æ—Ä–¥ –¥–ª—è ${monster}?`)) {
                const records = JSON.parse(localStorage.getItem(recordType) || '{}');
                delete records[monster];
                localStorage.setItem(recordType, JSON.stringify(records));
                displayAttackRecords(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ä–µ–∫–æ—Ä–¥–∞ –¥–µ–Ω–µ–≥
        function deleteMoneyRecord() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ä–µ–∫–æ—Ä–¥ –¥–µ–Ω–µ–≥?')) {
                localStorage.removeItem('money-record');
                displayMoneyRecords(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∫–æ—Ä–¥–∞ –Ω–∞–ø–∞–¥–µ–Ω–∏–π
        function editRecord(recordType, monster) {
            const records = JSON.parse(localStorage.getItem(recordType) || '{}');
            const newCount = prompt(`–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è ${monster}:`, records[monster].count);
            
            if (newCount !== null) {
                records[monster].count = parseInt(newCount);
                records[monster].date = new Date().toISOString(); // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞—Ç—É
                localStorage.setItem(recordType, JSON.stringify(records));
                displayAttackRecords(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∫–æ—Ä–¥–∞ –¥–µ–Ω–µ–≥
        function editMoneyRecord() {
            const record = JSON.parse(localStorage.getItem('money-record') || '{"totalCopper": 0}');
            const newGold = prompt(`–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–æ–ª–æ—Ç–∞:`, record.gold);
            const newSilver = prompt(`–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Ä–µ–±—Ä–∞:`, record.silver);
            const newCopper = prompt(`–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ–¥–∏:`, record.copper);
            
            if (newGold !== null && newSilver !== null && newCopper !== null) {
                record.gold = parseInt(newGold);
                record.silver = parseInt(newSilver);
                record.copper = parseInt(newCopper);
                record.date = new Date().toISOString(); // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞—Ç—É
                localStorage.setItem('money-record', JSON.stringify(record));
                displayMoneyRecords(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∫–æ—Ä–¥–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function loadRecords() {
            displayAttackRecords();
            displayMoneyRecords();
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Ä–µ–∫–æ—Ä–¥–æ–≤
        function clearRecords(recordType) {
            if (recordType === 'attack-records') {
                localStorage.removeItem('attack-records');
                displayAttackRecords();
            } else if (recordType === 'money-record') {
                localStorage.removeItem('money-record');
                displayMoneyRecords();
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ –≤ –∏—Å—Ç–æ—Ä–∏—é
        function addHistoryEntry(type, data) {
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–µ–π –∏—Å—Ç–æ—Ä–∏–∏
            let history = JSON.parse(localStorage.getItem('log-history') || '[]');
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏
            const entry = {
                type: type,
                data: data,
                date: new Date().toISOString()
            };
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –∏—Å—Ç–æ—Ä–∏—é
            history.unshift(entry);
            
            // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ 100 –∑–∞–ø–∏—Å–µ–π)
            if (history.length > 100) {
                history = history.slice(0, 100);
            }
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏
            localStorage.setItem('log-history', JSON.stringify(history));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            displayHistory();
            loadStats();
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
        function displayHistory() {
            const historyContainer = document.getElementById('history-container');
            historyContainer.innerHTML = '';
            
            const history = JSON.parse(localStorage.getItem('log-history') || '[]');
            
            if (history.length === 0) {
                historyContainer.innerHTML = '<p>–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</p>';
                return;
            }
            
            // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ –¥–∞—Ç–∞–º (–±–µ–∑ —É—á–µ—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏)
            const groupedByDate = {};
            history.forEach(entry => {
                const date = new Date(entry.date).toLocaleDateString();
                if (!groupedByDate[date]) {
                    groupedByDate[date] = [];
                }
                groupedByDate[date].push(entry);
            });
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ –¥–Ω—è–º –≤ –≤–∏–¥–µ —Å–ø–æ–π–ª–µ—Ä–æ–≤
            for (const [date, entries] of Object.entries(groupedByDate)) {
                const historyDay = document.createElement('div');
                historyDay.className = 'history-day';
                
                // –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –¥–∞—Ç—ã (—Å–ø–æ–π–ª–µ—Ä)
                const dateHeader = document.createElement('div');
                dateHeader.className = 'history-date';
                dateHeader.innerHTML = `${date} <span>(${entries.length} –∑–∞–ø–∏—Å–µ–π)</span>`;
                dateHeader.onclick = function() {
                    const entriesDiv = this.nextElementSibling;
                    entriesDiv.style.display = entriesDiv.style.display === 'none' || entriesDiv.style.display === '' ? 'block' : 'none';
                };
                historyDay.appendChild(dateHeader);
                
                // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è –∑–∞–ø–∏—Å–µ–π —ç—Ç–æ–π –¥–∞—Ç—ã
                const entriesDiv = document.createElement('div');
                entriesDiv.className = 'history-entries';
                
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π –¥–ª—è —ç—Ç–æ–π –¥–∞—Ç—ã
                entries.forEach(entry => {
                    const entryDiv = document.createElement('div');
                    entryDiv.className = 'history-entry';
                    
                    // –í—Ä–µ–º—è –∑–∞–ø–∏—Å–∏
                    const timeDiv = document.createElement('div');
                    timeDiv.className = 'history-time';
                    timeDiv.textContent = new Date(entry.date).toLocaleTimeString();
                    entryDiv.appendChild(timeDiv);
                    
                    // –¢–∏–ø –∑–∞–ø–∏—Å–∏
                    const typeDiv = document.createElement('div');
                    typeDiv.className = 'history-type';
                    typeDiv.textContent = getTypeLabel(entry.type);
                    entryDiv.appendChild(typeDiv);
                    
                    // –î–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏
                    const dataDiv = document.createElement('div');
                    dataDiv.className = 'history-data';
                    
                    if (entry.type === 'money') {
                        // –î–ª—è –¥–µ–Ω–µ–≥ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –∏—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É
                        const totalMatch = entry.data.match(/–ò—Ç–æ–≥–æ: (\d+) .+?, (\d+) .+?, (\d+)/);
                        if (totalMatch) {
                            dataDiv.innerHTML = `${totalMatch[1]} <img src="./images/1.svg" class="coin" alt="–∑–æ–ª–æ—Ç–æ">, 
                                               ${totalMatch[2]} <img src="./images/2.svg" class="coin" alt="—Å–µ—Ä–µ–±—Ä–æ">, 
                                               ${totalMatch[3]} <img src="./images/3.svg" class="coin" alt="–º–µ–¥—å">`;
                        } else {
                            dataDiv.textContent = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
                        }
                    } else {
                        // –î–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                        const count = Object.keys(entry.data).length;
                        dataDiv.textContent = `–≠–ª–µ–º–µ–Ω—Ç–æ–≤: ${count}`;
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ–¥—Ä–æ–±–Ω–µ–µ" –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
                        const detailsButton = document.createElement('button');
                        detailsButton.textContent = '–ü–æ–¥—Ä–æ–±–Ω–µ–µ';
                        detailsButton.className = 'spoiler-button';
                        detailsButton.style.marginLeft = '10px';
                        detailsButton.onclick = function() {
                            const detailsDiv = this.nextElementSibling;
                            detailsDiv.style.display = detailsDiv.style.display === 'none' || detailsDiv.style.display === '' ? 'block' : 'none';
                        };
                        dataDiv.appendChild(detailsButton);
                        
                        // –°–æ–∑–¥–∞–µ–º —Å–∫—Ä—ã—Ç—ã–π div –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π
                        const detailsDiv = document.createElement('div');
                        detailsDiv.style.display = 'none';
                        detailsDiv.style.marginTop = '10px';
                        
                        const detailsList = document.createElement('ul');
                        for (const [key, value] of Object.entries(entry.data)) {
                            const li = document.createElement('li');
                            if (entry.type === 'attacks' || entry.type === 'items') {
                                const img = document.createElement('img');
                                img.src = `./images/${key}.gif`;
                                img.alt = key;
                                img.className = 'item-image';
                                img.style.width = '50px';
                                img.style.height = '50px';
                                img.onerror = () => { img.style.display = 'none'; };
                                li.appendChild(img);
                            }
                            li.innerHTML += `${key}: ${value}`;
                            detailsList.appendChild(li);
                        }
                        detailsDiv.appendChild(detailsList);
                        dataDiv.appendChild(detailsDiv);
                    }
                    
                    entryDiv.appendChild(dataDiv);
                    entriesDiv.appendChild(entryDiv);
                });
                
                historyDay.appendChild(entriesDiv);
                historyContainer.appendChild(historyDay);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∫–∏ —Ç–∏–ø–∞ –∑–∞–ø–∏—Å–∏
        function getTypeLabel(type) {
            switch(type) {
                case 'attacks': return '–ù–∞–ø–∞–¥–µ–Ω–∏—è';
                case 'money': return '–î–µ–Ω—å–≥–∏';
                case 'items': return '–ü—Ä–µ–¥–º–µ—Ç—ã';
                default: return type;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function loadHistory() {
            displayHistory();
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏
        function clearHistory() {
            localStorage.removeItem('log-history');
            displayHistory();
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–≤–æ–π–Ω–æ–≥–æ —â–µ–ª—á–∫–∞ –Ω–∞ –∑–∞–ø–∏—Å–∏ –∏—Å—Ç–æ—Ä–∏–∏
        function handleHistoryEntryDblClick(event) {
            // –ò—â–µ–º –±–ª–∏–∂–∞–π—à–∏–π —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å –∫–ª–∞—Å—Å–æ–º history-entry
            const historyEntry = event.target.closest('.history-entry');
            if (!historyEntry) return;
            
            // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏?')) {
                // –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å –∑–∞–ø–∏—Å–∏
                const allEntries = document.querySelectorAll('.history-entry');
                const index = Array.from(allEntries).indexOf(historyEntry);
                
                if (index !== -1) {
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
                    let history = JSON.parse(localStorage.getItem('log-history') || '[]');
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫ –∫–∞–∫–æ–π –¥–∞—Ç–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∑–∞–ø–∏—Å—å
                    const dateContainer = historyEntry.closest('.history-entries');
                    const dateEntries = dateContainer.querySelectorAll('.history-entry');
                    const entryIndexInDate = Array.from(dateEntries).indexOf(historyEntry);
                    
                    // –ù–∞—Ö–æ–¥–∏–º –¥–∞—Ç—É
                    const dateHeader = dateContainer.previousElementSibling;
                    const dateText = dateHeader.textContent.split(' (')[0];
                    
                    // –§–∏–ª—å—Ç—Ä—É–µ–º –∑–∞–ø–∏—Å–∏ –ø–æ –¥–∞—Ç–µ –∏ –Ω–∞—Ö–æ–¥–∏–º –Ω—É–∂–Ω—É—é
                    const entriesForDate = history.filter(entry => {
                        return new Date(entry.date).toLocaleDateString() === dateText;
                    });
                    
                    if (entriesForDate.length > entryIndexInDate) {
                        // –ù–∞—Ö–æ–¥–∏–º –∑–∞–ø–∏—Å—å –≤ –æ–±—â–µ–º –º–∞—Å—Å–∏–≤–µ
                        const entryToRemove = entriesForDate[entryIndexInDate];
                        const indexInFullHistory = history.findIndex(entry => entry.date === entryToRemove.date);
                        
                        if (indexInFullHistory !== -1) {
                            // –£–¥–∞–ª—è–µ–º –∑–∞–ø–∏—Å—å
                            history.splice(indexInFullHistory, 1);
                            localStorage.setItem('log-history', JSON.stringify(history));
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                            displayHistory();
                        }
                    }
                }
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function loadStats() {
            displayMonstersStats();
            displayMoneyStats();
            displayItemsStats(); // –û–±–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã –≤—ã–ø–∞–¥–µ–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –º–æ–Ω—Å—Ç—Ä–∞–º
        function displayMonstersStats() {
            const statsContainer = document.getElementById('total-monsters-stats');
            const totalStats = getTotalMonstersStats();
            
            if (Object.keys(totalStats).length === 0) {
                statsContainer.innerHTML = '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –º–æ–Ω—Å—Ç—Ä–∞—Ö</p>';
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–Ω—Å—Ç—Ä–æ–≤ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É–±–∏–π—Å—Ç–≤ (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
            const sortedMonsters = Object.entries(totalStats).sort((a, b) => b[1] - a[1]);
            
            let html = '<table class="stats-table">';
            html += '<tr><th>–ú–æ–Ω—Å—Ç—Ä</th><th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th></tr>';
            
            for (const [monster, count] of sortedMonsters) {
                html += `<tr>
                    <td>
                        <img src="./images/${monster}.gif" class="item-image" style="width: 30px; height: 30px;" onerror="this.style.display='none'">
                        ${monster}
                    </td>
                    <td>${count}</td>
                </tr>`;
            }
            
            html += '</table>';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            const totalCount = sortedMonsters.reduce((sum, [_, count]) => sum + count, 0);
            html += `<p style="text-align: center; color: green; font-weight: bold;"><strong>–í—Å–µ–≥–æ –º–æ–Ω—Å—Ç—Ä–æ–≤ —É–±–∏—Ç–æ:</strong> ${totalCount}</p>`;
            
            statsContainer.innerHTML = html;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –º–æ–Ω—Å—Ç—Ä–∞–º
        function getTotalMonstersStats() {
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏—Å—Ç–æ—Ä–∏–∏
            const history = JSON.parse(localStorage.getItem('log-history') || '[]');
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–∏ —Ç–∏–ø–∞ 'attacks'
            const attackEntries = history.filter(entry => entry.type === 'attacks');
            
            // –°–æ–∑–¥–∞–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            const totalStats = {};
            
            // –°—É–º–º–∏—Ä—É–µ–º –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            attackEntries.forEach(entry => {
                for (const [monster, count] of Object.entries(entry.data)) {
                    totalStats[monster] = (totalStats[monster] || 0) + count;
                }
            });
            
            return totalStats;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –¥–µ–Ω—å–≥–∞–º
        function displayMoneyStats() {
            const statsContainer = document.getElementById('total-money-stats');
            const totalCopper = getTotalMoneyStats();
            
            if (totalCopper === 0) {
                statsContainer.innerHTML = '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –¥–µ–Ω—å–≥–∞—Ö</p>';
                return;
            }
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–µ–¥—å –≤ –∑–æ–ª–æ—Ç–æ, —Å–µ—Ä–µ–±—Ä–æ –∏ –º–µ–¥—å
            const gold = Math.floor(totalCopper / 10000);
            const remainder = totalCopper % 10000;
            const silver = Math.floor(remainder / 100);
            const copper = remainder % 100;
            
            let html = `<p style="text-align: center; color: #28a745; font-weight: bold; margin-bottom: 15px;"><strong>–í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ:</strong></p>`;
            html += `<div class="money-total" style="text-align: center;">
                ${gold} <img src="./images/1.svg" class="coin" alt="–∑–æ–ª–æ—Ç–æ">, 
                ${silver} <img src="./images/2.svg" class="coin" alt="—Å–µ—Ä–µ–±—Ä–æ">, 
                ${copper} <img src="./images/3.svg" class="coin" alt="–º–µ–¥—å">
            </div>`;
            
            statsContainer.innerHTML = html;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –¥–µ–Ω—å–≥–∞–º
        function getTotalMoneyStats() {
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏—Å—Ç–æ—Ä–∏–∏
            const history = JSON.parse(localStorage.getItem('log-history') || '[]');
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–∏ —Ç–∏–ø–∞ 'money'
            const moneyEntries = history.filter(entry => entry.type === 'money');
            
            // –°—á–µ—Ç—á–∏–∫ –¥–ª—è –æ–±—â–µ–π —Å—É–º–º—ã –º–µ–¥–∏
            let totalCopper = 0;
            
            // –°—É–º–º–∏—Ä—É–µ–º –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            moneyEntries.forEach(entry => {
                const totalMatch = entry.data.match(/–ò—Ç–æ–≥–æ: (\d+) .+?, (\d+) .+?, (\d+)/);
                if (totalMatch) {
                    const gold = parseInt(totalMatch[1]) || 0;
                    const silver = parseInt(totalMatch[2]) || 0;
                    const copper = parseInt(totalMatch[3]) || 0;
                    totalCopper += gold * 10000 + silver * 100 + copper;
                }
            });
            
            return totalCopper;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º
        function displayItemsStats() {
            const statsContainer = document.getElementById('total-items-stats');
            const frequencyStats = getTotalItemsStatsWithFrequency();
            
            if (Object.keys(frequencyStats).length === 0) {
                statsContainer.innerHTML = '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–µ–¥–º–µ—Ç–∞—Ö</p>';
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø—Ä–µ–¥–º–µ—Ç—ã –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≤—ã–ø–∞–¥–µ–Ω–∏–π (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
            const sortedItems = Object.entries(frequencyStats).sort((a, b) => b[1].count - a[1].count);
            
            let html = '<table class="stats-table">';
            html += '<tr><th>–ü—Ä–µ–¥–º–µ—Ç</th><th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–∞–¥–µ–Ω–∏–π</th><th>–ß–∞—Å—Ç–æ—Ç–∞ (%)</th></tr>';
            
            for (const [item, data] of sortedItems) {
                html += `<tr>
                    <td>
                        <img src="./images/${item}.gif" class="item-image" style="width: 30px; height: 30px;" onerror="this.style.display='none'">
                        ${item}
                    </td>
                    <td>${data.count}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span>${data.frequency}%</span>
                            <div class="drop-progress" style="flex: 1; max-width: 100px;">
                                <div class="drop-progress-fill" style="width: ${data.frequency}%;"></div>
                            </div>
                        </div>
                    </td>
                </tr>`;
            }
            
            html += '</table>';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            const totalCount = Object.values(frequencyStats).reduce((sum, data) => sum + data.count, 0);
            html += `<p style="text-align: center; color: green; font-weight: bold;"><strong>–í—Å–µ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ —Å–æ–±—Ä–∞–Ω–æ:</strong> ${totalCount}</p>`;
            
            statsContainer.innerHTML = html;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º —Å —á–∞—Å—Ç–æ—Ç–æ–π
        function getTotalItemsStatsWithFrequency() {
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏—Å—Ç–æ—Ä–∏–∏
            const history = JSON.parse(localStorage.getItem('log-history') || '[]');
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–∏ —Ç–∏–ø–∞ 'items'
            const itemEntries = history.filter(entry => entry.type === 'items');
            
            // –°–æ–∑–¥–∞–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            const totalStats = {};
            
            // –°—É–º–º–∏—Ä—É–µ–º –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            itemEntries.forEach(entry => {
                for (const [item, count] of Object.entries(entry.data)) {
                    totalStats[item] = (totalStats[item] || 0) + count;
                }
            });
            
            // –í—ã—á–∏—Å–ª—è–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–∞–¥–µ–Ω–∏–π
            const totalCount = Object.values(totalStats).reduce((sum, count) => sum + count, 0);
            
            // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã
            const frequencyStats = {};
            
            // –í—ã—á–∏—Å–ª—è–µ–º —á–∞—Å—Ç–æ—Ç—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞
            for (const [item, count] of Object.entries(totalStats)) {
                frequencyStats[item] = {
                    count: count,
                    frequency: ((count / totalCount) * 100).toFixed(2) // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–æ –¥–≤—É—Ö –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
                };
            }
            
            return frequencyStats;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function clearAllStats() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                localStorage.removeItem('log-history');
                localStorage.removeItem('attack-records');
                localStorage.removeItem('money-record');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                loadRecords();
                loadHistory();
                loadStats();
                
                alert('–í—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–±—Ä–æ—à–µ–Ω–∞.');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ —Ç–µ–∫—Å—Ç–∞ –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞
        function insertLog() {
            navigator.clipboard.readText().then(text => {
                const textarea = document.getElementById('logInput');
                textarea.value = text;
                textarea.focus();
            }).catch(err => {
                console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞:', err);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –≤—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Å—Ç–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é (Ctrl+V).');
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ª–æ–≥–∞
        function clearLog() {
            const textarea = document.getElementById('logInput');
            textarea.value = '';
            textarea.focus();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        function displayItemResults(itemCounts) {
            const resultsDiv = document.getElementById('results');
            
            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
            const totalItems = Object.values(itemCounts).reduce((sum, count) => sum + count, 0);
            const uniqueItems = Object.keys(itemCounts).length;
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ –∏–∫–æ–Ω–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–∞
            function getItemIcon(itemName) {
                const name = itemName.toLowerCase();
                if (name.includes('–º–µ—á') || name.includes('–∫–ª–∏–Ω–æ–∫') || name.includes('–ª–µ–∑–≤–∏–µ')) return 'fas fa-sword';
                if (name.includes('—â–∏—Ç') || name.includes('—Ç–∞—Ä–≥')) return 'fas fa-shield-alt';
                if (name.includes('—à–ª–µ–º') || name.includes('–∫–∞—Å–∫–∞')) return 'fas fa-hard-hat';
                if (name.includes('–¥–æ—Å–ø–µ—Ö') || name.includes('–±—Ä–æ–Ω—è') || name.includes('–∫–æ–ª—å—á—É–≥–∞')) return 'fas fa-vest';
                if (name.includes('–∫–æ–ª—å—Ü–æ') || name.includes('–ø–µ—Ä—Å—Ç–µ–Ω—å')) return 'fas fa-ring';
                if (name.includes('—ç–ª–∏–∫—Å–∏—Ä') || name.includes('–∑–µ–ª—å–µ') || name.includes('–Ω–∞—Å—Ç–æ–π–∫–∞')) return 'fas fa-flask';
                if (name.includes('–º–æ–Ω–µ—Ç–∞') || name.includes('–∑–æ–ª–æ—Ç') || name.includes('—Å–µ—Ä–µ–±—Ä') || name.includes('–º–µ–¥—å')) return 'fas fa-coins';
                if (name.includes('–∫–∞–º–µ–Ω—å') || name.includes('—Ä—É–¥–∞') || name.includes('–∫—Ä–∏—Å—Ç–∞–ª–ª')) return 'fas fa-gem';
                if (name.includes('–∫–Ω–∏–≥–∞') || name.includes('—Å–≤–∏—Ç–æ–∫') || name.includes('—Ç–æ–º')) return 'fas fa-book';
                if (name.includes('—Å—É–º–∫–∞') || name.includes('–º–µ—à–æ–∫') || name.includes('—Ä—é–∫–∑–∞–∫')) return 'fas fa-shopping-bag';
                if (name.includes('–ª—É–∫') || name.includes('–∞—Ä–±–∞–ª–µ—Ç')) return 'fas fa-bow-arrow';
                if (name.includes('–ø–æ—Å–æ—Ö') || name.includes('–∂–µ–∑–ª')) return 'fas fa-magic';
                return 'fas fa-cube'; // –ò–∫–æ–Ω–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            }
            
            let html = `
                <h2 style="font-weight: bold; color: var(--primary-color); margin-bottom: 20px;">
                    <i class="fas fa-search"></i> –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
                </h2>
                <div class="results-summary">
                    <div class="summary-text">
                        –ù–∞–π–¥–µ–Ω–æ: ${totalItems} –ø—Ä–µ–¥–º–µ—Ç–æ–≤ (${uniqueItems} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö)
                    </div>
                </div>
                <div class="items-grid">
            `;
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø—Ä–µ–¥–º–µ—Ç—ã –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
            const sortedItems = Object.entries(itemCounts).sort((a, b) => b[1] - a[1]);
            
            sortedItems.forEach(([itemName, count]) => {
                const icon = getItemIcon(itemName);
                html += `
                    <div class="item-card">
                        <div class="item-icon">
                            <img src="./images/${itemName}.gif" class="item-image" alt="${itemName}" 
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" 
                                 style="width: 40px; height: 40px; border-radius: 50%;">
                            <i class="${icon}" style="display: none;"></i>
                        </div>
                        <div class="item-info">
                            <div class="item-name">${itemName}</div>
                            <div class="item-count">${count} —à—Ç.</div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            resultsDiv.innerHTML = html;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
            addHistoryEntry('items', itemCounts);
        }

        // === –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –î–†–û–ü–û–ú ===

        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ —Å —Ü–µ–Ω–æ–π
        function addDropItem() {
            const nameInput = document.getElementById('dropItemName');
            const goldInput = document.getElementById('dropItemGold');
            const silverInput = document.getElementById('dropItemSilver');
            const copperInput = document.getElementById('dropItemCopper');
            
            const name = nameInput.value.trim();
            const gold = parseInt(goldInput.value) || 0;
            const silver = parseInt(silverInput.value) || 0;
            const copper = parseInt(copperInput.value) || 0;
            
            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞');
                return;
            }
            
            if (gold === 0 && silver === 0 && copper === 0) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –ø—Ä–µ–¥–º–µ—Ç–∞');
                return;
            }
            
            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤—Å–µ –≤ —Å–µ—Ä–µ–±—Ä–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è (–∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ)
            const totalSilver = gold * 100 + silver + copper / 100;
            
            const dropItems = getDropItems();
            dropItems[name] = {
                gold: gold,
                silver: silver,
                copper: copper,
                totalSilver: totalSilver
            };
            saveDropItems(dropItems);
            
            nameInput.value = '';
            goldInput.value = '0';
            silverInput.value = '0';
            copperInput.value = '0';
            
            loadDropItems();
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ —Å —Ü–µ–Ω–∞–º–∏
        function loadDropItems() {
            const dropItems = getDropItems();
            const container = document.getElementById('dropItemsList');
            
            if (Object.keys(dropItems).length === 0) {
                container.innerHTML = '<div class="no-drop-data">–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤</div>';
                return;
            }
            
            let html = '';
            Object.entries(dropItems).forEach(([name, priceData]) => {
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç (—Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ) –∏ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç (–æ–±—ä–µ–∫—Ç)
                const price = typeof priceData === 'number' ? 
                    {gold: 0, silver: Math.floor(priceData), copper: Math.round((priceData % 1) * 100), totalSilver: priceData} : 
                    priceData;
                
                html += `
                    <div class="drop-item" data-item="${name}">
                        <div class="drop-item-info">
                            <img src="./images/${name}.gif" class="item-image" style="width: 40px; height: 40px;" onerror="this.style.display='none'">
                            <div class="drop-item-details">
                                <span class="drop-item-name">${name}</span>
                                <span class="drop-item-price">${formatDropPrice(price)}</span>
                            </div>
                        </div>
                        <div class="drop-item-actions">
                            <button class="edit-btn" onclick="editDropItem('${name}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="delete-btn" onclick="deleteDropItem('${name}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="edit-drop-form" id="edit-${name}">
                            <input type="text" id="edit-name-${name}" value="${name}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                            <div class="currency-input">
                                <div class="currency-field">
                                    <img src="./images/1.svg" class="coin" alt="–ó–æ–ª–æ—Ç–æ">
                                    <input type="number" id="edit-gold-${name}" value="${price.gold || 0}" min="0">
                                </div>
                                <div class="currency-field">
                                    <img src="./images/2.svg" class="coin" alt="–°–µ—Ä–µ–±—Ä–æ">
                                    <input type="number" id="edit-silver-${name}" value="${price.silver || 0}" min="0">
                                </div>
                                <div class="currency-field">
                                    <img src="./images/3.svg" class="coin" alt="–ú–µ–¥—å">
                                    <input type="number" id="edit-copper-${name}" value="${price.copper || 0}" min="0">
                                </div>
                            </div>
                            <button onclick="saveDropItemEdit('${name}')">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            <button onclick="cancelDropItemEdit('${name}')">–û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // –§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–∞
        function editDropItem(itemName) {
            const editForm = document.getElementById(`edit-${itemName}`);
            editForm.style.display = editForm.style.display === 'block' ? 'none' : 'block';
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–µ–¥–º–µ—Ç–∞
        function saveDropItemEdit(oldName) {
            const newName = document.getElementById(`edit-name-${oldName}`).value.trim();
            const gold = parseInt(document.getElementById(`edit-gold-${oldName}`).value) || 0;
            const silver = parseInt(document.getElementById(`edit-silver-${oldName}`).value) || 0;
            const copper = parseInt(document.getElementById(`edit-copper-${oldName}`).value) || 0;
            
            if (!newName) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞');
                return;
            }
            
            if (gold === 0 && silver === 0 && copper === 0) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –ø—Ä–µ–¥–º–µ—Ç–∞');
                return;
            }
            
            const totalSilver = gold * 100 + silver + copper / 100;
            
            const dropItems = getDropItems();
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –∑–∞–ø–∏—Å—å
            delete dropItems[oldName];
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é
            dropItems[newName] = {
                gold: gold,
                silver: silver,
                copper: copper,
                totalSilver: totalSilver
            };
            
            saveDropItems(dropItems);
            loadDropItems();
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–º–µ–Ω—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function cancelDropItemEdit(itemName) {
            const editForm = document.getElementById(`edit-${itemName}`);
            editForm.style.display = 'none';
        }

        // –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–∞
        function deleteDropItem(itemName) {
            if (confirm(`–£–¥–∞–ª–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç "${itemName}"?`)) {
                const dropItems = getDropItems();
                delete dropItems[itemName];
                saveDropItems(dropItems);
                loadDropItems();
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ –¥—Ä–æ–ø–∞ –∏–∑ –ª–æ–≥–∞
        function analyzeDrop() {
            const logInput = document.getElementById('logInput').value;
            const dropItems = getDropItems();
            
            if (Object.keys(dropItems).length === 0) {
                alert('–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã —Å —Ü–µ–Ω–∞–º–∏');
                return;
            }
            
            if (!logInput.trim()) {
                alert('–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞');
                return;
            }
            
            const foundItems = {};
            const logLines = logInput.split('\n');
            
            // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É –ª–æ–≥–∞
            logLines.forEach(line => {
                Object.keys(dropItems).forEach(itemName => {
                    // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
                    const escapedItem = itemName.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
                    // –ò—â–µ–º –ø—Ä–µ–¥–º–µ—Ç —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
                    const itemRegex = new RegExp(`${escapedItem}\\s+(\\d+)\\s+—à—Ç`, 'g');
                    
                    let match;
                    while ((match = itemRegex.exec(line)) !== null) {
                        const quantity = parseInt(match[1]) || 1;
                        foundItems[itemName] = (foundItems[itemName] || 0) + quantity;
                    }
                });
            });
            
            if (Object.keys(foundItems).length === 0) {
                document.getElementById('dropResults').innerHTML = 
                    '<div class="no-drop-data">–í –ª–æ–≥–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏–∑ —Å–ø–∏—Å–∫–∞</div>';
                return;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            saveDropAnalysis(foundItems, dropItems);
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            displayDropResults(foundItems, dropItems);
            
            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥—Ä–æ–ø–∞ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∫ –æ–±—â–µ–π –ø—Ä–∏–±—ã–ª–∏
            let totalDropValue = 0;
            Object.keys(foundItems).forEach(itemName => {
                const quantity = foundItems[itemName];
                const price = dropItems[itemName];
                totalDropValue += calculateTotalCopperFromPrice(price) * quantity;
            });
            addToTotalProfit(totalDropValue, 'drop');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            loadDropStats();
        }

        // –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–µ–Ω—ã –¥—Ä–æ–ø–∞ —Å –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏ –º–æ–Ω–µ—Ç
        function formatDropPrice(priceData) {
            if (typeof priceData === 'number') {
                // –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º
                const gold = Math.floor(priceData / 100);
                const silver = Math.floor(priceData % 100);
                const copper = Math.round((priceData % 1) * 100);
                priceData = {gold, silver, copper};
            }
            
            let result = '';
            if (priceData.gold > 0) {
                result += `<img src="./images/1.svg" class="coin" alt="–ó–æ–ª–æ—Ç–æ">${priceData.gold} `;
            }
            if (priceData.silver > 0) {
                result += `<img src="./images/2.svg" class="coin" alt="–°–µ—Ä–µ–±—Ä–æ">${priceData.silver} `;
            }
            if (priceData.copper > 0) {
                result += `<img src="./images/3.svg" class="coin" alt="–ú–µ–¥—å">${priceData.copper} `;
            }
            
            return result || '<img src="./images/3.svg" class="coin" alt="–ú–µ–¥—å">0';
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞
        function displayDropResults(foundItems, dropItems) {
            const container = document.getElementById('dropResults');
            
            let totalValueSilver = 0;
            let totalItems = 0;
            
            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å
            Object.entries(foundItems).forEach(([item, count]) => {
                const priceData = dropItems[item];
                if (priceData) {
                    const itemTotalSilver = typeof priceData === 'number' ? priceData : priceData.totalSilver;
                    totalValueSilver += count * itemTotalSilver;
                }
                totalItems += count;
            });
            
            let html = `
                <div class="drop-summary">
                    <div class="drop-summary-text">
                        –ù–∞–π–¥–µ–Ω–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤: ${totalItems} —à—Ç. | 
                        –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${formatPrice(totalValueSilver)}
                    </div>
                </div>
                <div class="drop-results-list">
            `;
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (—É–±—ã–≤–∞–Ω–∏–µ)
            const sortedItems = Object.entries(foundItems).sort((a, b) => {
                const priceDataA = dropItems[a[0]];
                const priceDataB = dropItems[b[0]];
                const valueA = priceDataA ? a[1] * (typeof priceDataA === 'number' ? priceDataA : priceDataA.totalSilver) : 0;
                const valueB = priceDataB ? b[1] * (typeof priceDataB === 'number' ? priceDataB : priceDataB.totalSilver) : 0;
                return valueB - valueA;
            });
            
            sortedItems.forEach(([item, count]) => {
                const priceData = dropItems[item];
                const itemTotalSilver = priceData ? (typeof priceData === 'number' ? priceData : priceData.totalSilver) : 0;
                const itemValue = count * itemTotalSilver;
                const percentage = totalValueSilver > 0 ? (itemValue / totalValueSilver * 100).toFixed(1) : 0;
                
                html += `
                    <div class="drop-stats-item">
                        <div class="drop-stats-info">
                            <img src="./images/${item}.gif" class="item-image" style="width: 40px; height: 40px;" onerror="this.style.display='none'">
                            <span class="drop-stats-name">${item}</span>
                            <span class="drop-stats-count">${count} —à—Ç.</span>
                            <span class="drop-stats-value">${formatPrice(itemValue)}</span>
                            <span class="drop-stats-percent">${percentage}%</span>
                        </div>
                        <div class="drop-progress-bar">
                            <div class="drop-progress">
                                <div class="drop-progress-fill" style="width: ${percentage}%">${percentage}%</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        function saveDropAnalysis(foundItems, dropItems) {
            const stats = getDropStats();
            const timestamp = new Date().toISOString();
            
            Object.entries(foundItems).forEach(([item, count]) => {
                const priceData = dropItems[item];
                const itemTotalSilver = priceData ? (typeof priceData === 'number' ? priceData : priceData.totalSilver) : 0;
                
                if (!stats[item]) {
                    stats[item] = {
                        totalCount: 0,
                        totalValue: 0,
                        price: priceData || {gold: 0, silver: 0, copper: 0, totalSilver: 0},
                        analyses: []
                    };
                }
                
                stats[item].totalCount += count;
                stats[item].totalValue += count * itemTotalSilver;
                stats[item].price = priceData || {gold: 0, silver: 0, copper: 0, totalSilver: 0}; // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—É
                stats[item].analyses.push({
                    date: timestamp,
                    count: count,
                    value: count * itemTotalSilver
                });
            });
            
            saveDropStats(stats);
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥—Ä–æ–ø–∞
        function loadDropStats() {
            const stats = getDropStats();
            const container = document.getElementById('total-drop-stats');
            
            if (Object.keys(stats).length === 0) {
                container.innerHTML = '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –¥—Ä–æ–ø—É</p>';
                return;
            }
            
            let totalValue = 0;
            let totalItems = 0;
            
            Object.values(stats).forEach(item => {
                totalValue += item.totalValue;
                totalItems += item.totalCount;
            });
            
            let html = `
                <div class="drop-summary">
                    <div class="drop-summary-text">
                        –í—Å–µ–≥–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: ${totalItems} –ø—Ä–µ–¥–º–µ—Ç–æ–≤<br>
                        –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${formatPrice(totalValue)}
                    </div>
                </div>
            `;
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
            const sortedStats = Object.entries(stats).sort((a, b) => b[1].totalValue - a[1].totalValue);
            
            sortedStats.forEach(([item, data]) => {
                const percentage = totalValue > 0 ? (data.totalValue / totalValue * 100) : 0;
                const displayPercentage = percentage.toFixed(2); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ 2 –∑–Ω–∞–∫–æ–≤
                
                // –£–ª—É—á—à–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤
                let barWidth = Math.max(percentage, 5); // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ 5% –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏
                if (percentage < 3) {
                    barWidth = Math.max(percentage * 3, 10); // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –º–µ–ª–∫–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç—ã
                }
                
                html += `
                    <div class="drop-stats-item">
                        <div class="drop-stats-info">
                            <img src="./images/${item}.gif" class="item-image" style="width: 40px; height: 40px;" onerror="this.style.display='none'">
                            <span class="drop-stats-name">${item}</span>
                            <span class="drop-stats-count">${data.totalCount} —à—Ç.</span>
                            <span class="drop-stats-value">${formatPrice(data.totalValue)}</span>
                            <span class="drop-stats-percent">${displayPercentage}%</span>
                        </div>
                        <div class="drop-progress-bar" style="position: relative; width: 60%;">
                            <div class="drop-progress">
                                <div class="drop-progress-fill" style="width: ${barWidth}%; min-width: 10px; position: relative;">
                                    <span style="position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); font-size: 11px; color: white; font-weight: bold; text-shadow: 1px 1px 1px rgba(0,0,0,0.5);">${displayPercentage}%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // –§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –æ –¥—Ä–æ–ø–µ
        function exportDropData() {
            const dropItems = getDropItems();
            const dropStats = getDropStats();
            
            const exportData = {
                items: dropItems,
                statistics: dropStats,
                exportDate: new Date().toISOString(),
                version: "1.0"
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `drop_data_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        // –§—É–Ω–∫—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –æ –¥—Ä–æ–ø–µ
        function importDropData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importData = JSON.parse(e.target.result);
                    
                    if (importData.items) {
                        if (confirm('–ó–∞–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏?')) {
                            saveDropItems(importData.items);
                            loadDropItems();
                        }
                    }
                    
                    if (importData.statistics) {
                        if (confirm('–ó–∞–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π?')) {
                            saveDropStats(importData.statistics);
                            loadDropStats();
                        }
                    }
                    
                    alert('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö: ' + error.message);
                }
            };
            reader.readAsText(file);
            
            // –û—á–∏—Å—Ç–∫–∞ input –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Ç–æ–≥–æ –∂–µ —Ñ–∞–π–ª–∞
            event.target.value = '';
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –æ –¥—Ä–æ–ø–µ
        function clearDropData() {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ –¥—Ä–æ–ø–µ (–ø—Ä–µ–¥–º–µ—Ç—ã, —Ü–µ–Ω—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É)?')) {
                localStorage.removeItem('dropItems');
                localStorage.removeItem('dropStats');
                loadDropItems();
                loadDropStats();
                document.getElementById('dropResults').innerHTML = '';
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å localStorage
        function getDropItems() {
            return JSON.parse(localStorage.getItem('dropItems') || '{}');
        }

        function saveDropItems(items) {
            localStorage.setItem('dropItems', JSON.stringify(items));
        }

        function getDropStats() {
            return JSON.parse(localStorage.getItem('dropStats') || '{}');
        }

        function saveDropStats(stats) {
            localStorage.setItem('dropStats', JSON.stringify(stats));
        }

        // –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–µ–Ω—ã –≤ –∑–æ–ª–æ—Ç–æ/—Å–µ—Ä–µ–±—Ä–æ/–º–µ–¥—å
        function formatPrice(silverAmount) {
            const gold = Math.floor(silverAmount / 100);
            const silver = Math.floor(silverAmount % 100);
            const copper = Math.round((silverAmount % 1) * 100);
            
            let result = '';
            if (gold > 0) {
                result += `<img src="./images/1.svg" class="coin" alt="–ó–æ–ª–æ—Ç–æ">${gold} `;
            }
            if (silver > 0) {
                result += `<img src="./images/2.svg" class="coin" alt="–°–µ—Ä–µ–±—Ä–æ">${silver} `;
            }
            if (copper > 0) {
                result += `<img src="./images/3.svg" class="coin" alt="–ú–µ–¥—å">${copper} `;
            }
            
            if (result === '') {
                result = '<img src="./images/3.svg" class="coin" alt="–ú–µ–¥—å">0';
            }
            
            return result;
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é clearAllStats –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥—Ä–æ–ø–∞
        function clearAllStats() {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (–º–æ–Ω—Å—Ç—Ä—ã, –¥–µ–Ω—å–≥–∏, –ø—Ä–µ–¥–º–µ—Ç—ã, –¥—Ä–æ–ø –∏ –æ–±—â–∞—è –ø—Ä–∏–±—ã–ª—å)?')) {
                localStorage.removeItem('monsterStats');
                localStorage.removeItem('moneyStats');
                localStorage.removeItem('itemStats');
                localStorage.removeItem('dropStats');
                localStorage.removeItem('totalProfitGold');
                localStorage.removeItem('totalProfitSilver');
                localStorage.removeItem('totalProfitCopper');
                localStorage.removeItem('totalAnalyses');
                loadStats();
                loadDropStats();
                updateTotalProfitDisplay();
            }
        }

        // === –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –û–ë–©–ï–ô –ü–†–ò–ë–´–õ–¨–Æ ===
        
        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–±—ã–ª–∏ –∫ –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ (–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –º–µ–¥–Ω—ã–µ –º–æ–Ω–µ—Ç—ã –∏ —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏)
        function addToTotalProfit(copperAmount, operationType = 'general') {
            if (copperAmount <= 0) return; // –ù–µ –¥–æ–±–∞–≤–ª—è–µ–º –Ω—É–ª–µ–≤—ã–µ –∏–ª–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            
            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –º–µ–¥–Ω—ã–µ –º–æ–Ω–µ—Ç—ã –≤ –∑–æ–ª–æ—Ç–æ, —Å–µ—Ä–µ–±—Ä–æ, –º–µ–¥—å
            const gold = Math.floor(copperAmount / 10000);
            const remainder = copperAmount % 10000;
            const silver = Math.floor(remainder / 100);
            const copper = remainder % 100;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫ –æ–±—â–∏–º –∑–Ω–∞—á–µ–Ω–∏—è–º
            let totalGold = parseInt(localStorage.getItem('totalProfitGold') || '0');
            let totalSilver = parseInt(localStorage.getItem('totalProfitSilver') || '0');
            let totalCopper = parseInt(localStorage.getItem('totalProfitCopper') || '0');
            let analysesCount = parseInt(localStorage.getItem('totalAnalyses') || '0');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫ —Ä–∞–∑–¥–µ–ª—å–Ω—ã–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏
            if (operationType === 'monster') {
                let monsterGold = parseInt(localStorage.getItem('monsterProfitGold') || '0');
                let monsterSilver = parseInt(localStorage.getItem('monsterProfitSilver') || '0');
                let monsterCopper = parseInt(localStorage.getItem('monsterProfitCopper') || '0');
                
                monsterGold += gold;
                monsterSilver += silver;
                monsterCopper += copper;
                
                // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤–∞–ª—é—Ç—É –¥–ª—è –º–æ–Ω—Å—Ç—Ä–æ–≤
                if (monsterCopper >= 100) {
                    monsterSilver += Math.floor(monsterCopper / 100);
                    monsterCopper = monsterCopper % 100;
                }
                if (monsterSilver >= 100) {
                    monsterGold += Math.floor(monsterSilver / 100);
                    monsterSilver = monsterSilver % 100;
                }
                
                localStorage.setItem('monsterProfitGold', monsterGold.toString());
                localStorage.setItem('monsterProfitSilver', monsterSilver.toString());
                localStorage.setItem('monsterProfitCopper', monsterCopper.toString());
                
            } else if (operationType === 'drop') {
                let dropGold = parseInt(localStorage.getItem('dropProfitGold') || '0');
                let dropSilver = parseInt(localStorage.getItem('dropProfitSilver') || '0');
                let dropCopper = parseInt(localStorage.getItem('dropProfitCopper') || '0');
                
                dropGold += gold;
                dropSilver += silver;
                dropCopper += copper;
                
                // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤–∞–ª—é—Ç—É –¥–ª—è –¥—Ä–æ–ø–∞
                if (dropCopper >= 100) {
                    dropSilver += Math.floor(dropCopper / 100);
                    dropCopper = dropCopper % 100;
                }
                if (dropSilver >= 100) {
                    dropGold += Math.floor(dropSilver / 100);
                    dropSilver = dropSilver % 100;
                }
                
                localStorage.setItem('dropProfitGold', dropGold.toString());
                localStorage.setItem('dropProfitSilver', dropSilver.toString());
                localStorage.setItem('dropProfitCopper', dropCopper.toString());
            }
            
            totalGold += gold;
            totalSilver += silver;
            totalCopper += copper;
            analysesCount += 1;
            
            // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –æ–±—â—É—é –≤–∞–ª—é—Ç—É
            if (totalCopper >= 100) {
                totalSilver += Math.floor(totalCopper / 100);
                totalCopper = totalCopper % 100;
            }
            if (totalSilver >= 100) {
                totalGold += Math.floor(totalSilver / 100);
                totalSilver = totalSilver % 100;
            }
            
            localStorage.setItem('totalProfitGold', totalGold.toString());
            localStorage.setItem('totalProfitSilver', totalSilver.toString());
            localStorage.setItem('totalProfitCopper', totalCopper.toString());
            localStorage.setItem('totalAnalyses', analysesCount.toString());
            
            // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            console.log(`–î–æ–±–∞–≤–ª–µ–Ω–æ –∫ –æ–±—â–µ–π –ø—Ä–∏–±—ã–ª–∏ (${operationType}): ${gold}–∑ ${silver}—Å ${copper}–º`);
            
            updateTotalProfitDisplay();
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—â–µ–π –ø—Ä–∏–±—ã–ª–∏
        function updateTotalProfitDisplay() {
            const totalProfitGold = parseInt(localStorage.getItem('totalProfitGold') || '0');
            const totalProfitSilver = parseInt(localStorage.getItem('totalProfitSilver') || '0');
            const totalProfitCopper = parseInt(localStorage.getItem('totalProfitCopper') || '0');
            
            // –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑–¥–µ–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            const monsterGold = parseInt(localStorage.getItem('monsterProfitGold') || '0');
            const monsterSilver = parseInt(localStorage.getItem('monsterProfitSilver') || '0');
            const monsterCopper = parseInt(localStorage.getItem('monsterProfitCopper') || '0');
            
            const dropGold = parseInt(localStorage.getItem('dropProfitGold') || '0');
            const dropSilver = parseInt(localStorage.getItem('dropProfitSilver') || '0');
            const dropCopper = parseInt(localStorage.getItem('dropProfitCopper') || '0');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            document.getElementById('monster-profit-amount').innerHTML = formatCurrencyDisplay(monsterGold, monsterSilver, monsterCopper);
            document.getElementById('drop-profit-amount').innerHTML = formatCurrencyDisplay(dropGold, dropSilver, dropCopper);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫—Ä–∞—Å–∏–≤–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±—â–µ–≥–æ –¥–æ—Ö–æ–¥–∞
            document.getElementById('total-gold-amount').textContent = totalProfitGold;
            document.getElementById('total-silver-amount').textContent = totalProfitSilver;
            document.getElementById('total-copper-amount').textContent = totalProfitCopper;
            
            // –ë–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ —Å–∫—Ä—ã–≤–∞—Ç—å –±–ª–æ–∫–∏, —Ç–∞–∫ –∫–∞–∫ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–æ–≤—ã–π –¥–∏–∑–∞–π–Ω
            // –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω—ã –≤ –Ω–æ–≤–æ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º layout
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∞–ª—é—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function formatCurrencyDisplay(gold, silver, copper) {
            let result = '';
            if (gold > 0) result += `${gold} <img src="./images/1.svg" class="coin" alt="–ó–æ–ª–æ—Ç–æ">`;
            if (silver > 0) result += ` ${silver} <img src="./images/2.svg" class="coin" alt="–°–µ—Ä–µ–±—Ä–æ">`;
            if (copper > 0) result += ` ${copper} <img src="./images/3.svg" class="coin" alt="–ú–µ–¥—å">`;
            return result || '0 <img src="./images/3.svg" class="coin" alt="–ú–µ–¥—å">';
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ–±—â–µ–π –ø—Ä–∏–±—ã–ª–∏
        function resetTotalProfit() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ–±—â–µ–π –ø—Ä–∏–±—ã–ª–∏?')) {
                localStorage.removeItem('totalProfitGold');
                localStorage.removeItem('totalProfitSilver');
                localStorage.removeItem('totalProfitCopper');
                localStorage.removeItem('monsterProfitGold');
                localStorage.removeItem('monsterProfitSilver');
                localStorage.removeItem('monsterProfitCopper');
                localStorage.removeItem('dropProfitGold');
                localStorage.removeItem('dropProfitSilver');
                localStorage.removeItem('dropProfitCopper');
                localStorage.removeItem('totalAnalyses');
                updateTotalProfitDisplay();
                alert('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—â–µ–π –ø—Ä–∏–±—ã–ª–∏ —Å–±—Ä–æ—à–µ–Ω–∞.');
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ü–µ–Ω—ã –≤ –º–µ–¥–Ω—ã–µ –º–æ–Ω–µ—Ç—ã
        function calculateTotalCopperFromPrice(price) {
            let totalCopper = 0;
            if (price.gold) totalCopper += price.gold * 10000;
            if (price.silver) totalCopper += price.silver * 100;
            if (price.copper) totalCopper += price.copper;
            return totalCopper;
        }
    </script>
</body>
</html>
